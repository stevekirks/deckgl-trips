(this["webpackJsonpdeckgl-trips"]=this["webpackJsonpdeckgl-trips"]||[]).push([[0],{126:function(t,e){},167:function(t,e,n){},185:function(t,e){},190:function(t,e,n){},191:function(t,e,n){},192:function(t,e,n){},202:function(t,e,n){"use strict";n.r(e);var i=n(1),a=n.n(i),l=n(88),o=n.n(l),s=(n(167),n(123)),r=n(6),c=n(127),u=n(212),h=n(219),d=n(217),j=n(15),p=function(t){var e=Object(i.useState)(0),n=Object(r.a)(e,2),a=n[0],l=n[1],o=Object(i.useState)({id:0}),s=Object(r.a)(o,1)[0];Object(i.useEffect)((function(){return s.id=window.requestAnimationFrame((function e(){if(null!=t.loopLength){var n=Date.now()-t.timestampOffset,i=60*t.loopTimeMinutes*1e3;l(n%i*(t.loopLength/i))}s.id=window.requestAnimationFrame(e)})),function(){return window.cancelAnimationFrame(s.id)}}),[s,t.loopLength,t.timestampOffset,t.loopTimeMinutes]);var c=[];return null!=t.trips&&c.push(new u.a({id:"trips",data:t.trips,getPath:function(t){return t.segments.map((function(t){return t.coordinates}))},getTimestamps:function(t){return t.segments.map((function(t){return t.timestamp}))},getColor:function(e){var n=t.color,i=e.color;return null!=i&&(n=i),null!=e.nodes&&t.highlightedNodes.length>0&&e.nodes.forEach((function(e){null!=t.highlightedNodes.find((function(t){return e.toLowerCase()===t.toLowerCase()}))&&(n=t.highlightColor)})),n},opacity:.3,widthMinPixels:2,trailLength:t.trailLength,currentTime:a})),null!=t.nodes&&c.push(new h.a({id:"geojson-layer",data:t.nodes,filled:!0,getFillColor:function(){return[0,255,178,150]},stroked:!0,extruded:!1,pointRadiusScale:100,getRadius:function(){return.4},pickable:!0,autoHighlight:!0,highlightColor:[0,255,178,250],onHover:t.handleOnHover,onClick:function(t){return console.log(t.object.properties.name)}})),0===c.length?null:Object(j.jsx)(d.a,{initialViewState:t.initialViewState,viewState:t.viewport,layers:c})},g=n(3),b=n(2),f=n(8),m=n(153),O=(n(190),function(t){Object(f.a)(n,t);var e=Object(m.a)(n);function n(){return Object(g.a)(this,n),e.apply(this,arguments)}return Object(b.a)(n,[{key:"render",value:function(){return Object(j.jsx)("div",{className:"spinner-container",children:Object(j.jsxs)("div",{className:"spinner",children:[Object(j.jsx)("div",{className:"spinner-circle spinner-circle-outer"}),Object(j.jsx)("div",{className:"spinner-circle spinner-circle-inner"}),Object(j.jsx)("div",{className:"spinner-circle spinner-circle-single-1"}),Object(j.jsx)("div",{className:"spinner-circle spinner-circle-single-2"}),Object(j.jsx)("div",{className:"text",children:"Loading"})]})})}}]),n}(i.Component));function v(t){return new URL(window.location.href).searchParams.get(t)}function x(t){if(null!=t){var e=Number(t);if(!Number.isNaN(e))return e}return null}var w="dataIdx",S="loopTime",L="trailLength",T="highlightNodes";function N(t,e,n){for(var i=t.length>0?t.split("&"):[],a=!1,l=0;l<i.length;l++){i[l].split("=")[0]===e&&(i[l]=e+"="+(n||""),a=!0)}return!1===a&&i.push(e+"="+(n||"")),i.join("&")}function C(t){var e=decodeURIComponent(window.location.search.substring(1));null!=t.dataSampleIdx&&(e=N(e,w,String(t.dataSampleIdx))),null!=t.loopTime&&(e=N(e,S,String(t.loopTime))),null!=t.trailLength&&(e=N(e,L,String(t.trailLength))),null!=t.highlightedNodes&&(e=N(e,T,t.highlightedNodes.join(",")));var n="?"+e;window.history.pushState({},"",n)}var y=n(128),k=(n(191),n(192),n(193),{color:[23,184,190],colors:[[0,255,246],[255,235,86],[255,109,245],[0,255,119]],dataSamples:[{title:"SE QLD Transport",tripsUrl:"data/south-east-qld/trips.json",geoJsonUrl:"data/south-east-qld/geojson-stops.json",nodeListUrl:"data/south-east-qld/stops-list.json",initialPartialViewport:{latitude:-27.44,longitude:153.05,zoom:11}},{title:"SC Transport",tripsUrl:"data/sunshine-coast/trips.json",geoJsonUrl:"data/sunshine-coast/geojson-stops.json",nodeListUrl:"data/sunshine-coast/stops-list.json",initialPartialViewport:{latitude:-26.65,longitude:153.02,zoom:10}}],highlightColor:[253,128,93],initialLoopTimeMinutes:3,initialTrailLength:100,initialViewport:{latitude:-27.44,longitude:153.05,zoom:11,maxZoom:20,pitch:45,bearing:0,width:500,height:500},mapboxStyle:"mapbox://styles/stevejk/ckewepbut0ofs19obaw54z2lg",mapboxToken:"pk.eyJ1Ijoic3RldmVqayIsImEiOiJja24ya3dvZGMxOGZhMnZtbG9lOGJkem44In0.5vrcHDx_DfpxCXSLWwi4Ng",nodeLabel:"Stop",nodeLabelPlural:"Stops",title:"Trips"}),I=n(99);n.n(I).a.workerClass=n(194).default;var M=function(){var t=function(){var t={dataSampleIdx:null,loopTime:null,trailLength:null,highlightedNodes:null},e=x(v(w));null!=e&&e>=0&&(t.dataSampleIdx=e);var n=x(v(S));null!=n&&n>0&&n<999999&&(t.loopTime=n);var i=x(v(L));null!=i&&i>0&&i<999999&&(t.trailLength=i);var a=v(T);return null!=a&&a.length>0&&(t.highlightedNodes=a.split(",")),t}(),e=t.dataSampleIdx||0,n=Object(i.useState)(k),a=Object(r.a)(n,1)[0],l=Object(i.useState)(e),o=Object(r.a)(l,2),u=o[0],h=o[1],d=Object(i.useState)(""),g=Object(r.a)(d,2),b=g[0],f=g[1],m=Object(i.useState)(""),N=Object(r.a)(m,2),I=N[0],M=N[1],D=Object(i.useState)(!1),V=Object(r.a)(D,2),F=V[0],P=V[1],A=Object(i.useState)(null!=t.highlightedNodes?t.highlightedNodes:[]),E=Object(r.a)(A,2),H=E[0],U=E[1],J=Object(i.useState)(1e3),G=Object(r.a)(J,2),q=G[0],B=G[1],R=Object(i.useState)(t.loopTime||k.initialLoopTimeMinutes),z=Object(r.a)(R,2),Z=z[0],W=z[1],X=Object(i.useState)([]),Q=Object(r.a)(X,2),Y=Q[0],_=Q[1],K=Object(i.useState)(null),$=Object(r.a)(K,2),tt=$[0],et=$[1],nt=Object(i.useState)(0),it=Object(r.a)(nt,2),at=it[0],lt=it[1],ot=Object(i.useState)(null),st=Object(r.a)(ot,2),rt=st[0],ct=st[1],ut=Object(i.useState)(new Date(2e3,1,1,0,0,0)),ht=Object(r.a)(ut,2),dt=ht[0],jt=ht[1],pt=Object(i.useState)(Date.now()),gt=Object(r.a)(pt,2),bt=gt[0],ft=gt[1],mt=Object(i.useState)(1),Ot=Object(r.a)(mt,2),vt=Ot[0],xt=Ot[1],wt=Object(i.useState)(t.trailLength||k.initialTrailLength),St=Object(r.a)(wt,2),Lt=St[0],Tt=St[1],Nt=Object(i.useState)(null),Ct=Object(r.a)(Nt,2),yt=Ct[0],kt=Ct[1],It=Object(i.useState)(!1),Mt=Object(r.a)(It,2),Dt=Mt[0],Vt=Mt[1],Ft=Object(i.useState)(Object.assign({},k.initialViewport,k.dataSamples[e].initialPartialViewport)),Pt=Object(r.a)(Ft,2),At=Pt[0],Et=Pt[1];Object(i.useEffect)((function(){window.addEventListener("resize",Rt),Rt(),Ht(u),Ut(u),Jt(u);var t=setInterval((function(){return Vt((function(t){return!t}))}),1e3);return function(){clearInterval(t)}}),[]),Object(i.useEffect)((function(){if(null!=dt){var t=Date.now()-bt,e=60*Z*1e3,n=t%e,i=Math.floor(n/e*100),a=function(t){var e=t/vt,n=new Date(dt.getTime()+1e3*e),i=String(n.getMinutes());return i.length<2&&(i="0"+i),n.getDate()+"/"+(n.getMonth()+1)+"/"+n.getFullYear()+" "+n.getHours()+":"+i}(Math.floor(n*(q/e)));M(a),lt(i)}}),[Dt,bt,q,Z,dt,vt]);var Ht=function(t){var e=a.dataSamples[t].tripsUrl;fetch(e,{method:"GET",headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json; charset=utf-8"}}).then((function(t){200===t.status?t.json().then((function(t){var e=a.title;null!=t.friendlyName&&(e=t.friendlyName);var n=Number(t.startTimestamp)?new Date(1e3*t.startTimestamp):new Date(Date.parse(t.startTimestamp)),i=t.timeMultiplier,l=t.trips,o=t.loopLength;if(l.length>0&&l.length<=10)for(var s=0;s<l.length;s++)l[s].color=a.colors[s%a.colors.length];jt(n),ft(Date.now()),f(e),kt(l),B(o),xt(i)})):console.log("Sorry, something went wrong ("+t.status+")")})).catch((function(t){console.log(t)}))},Ut=function(t){fetch(a.dataSamples[t].nodeListUrl,{method:"GET",headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json; charset=utf-8"}}).then((function(t){200===t.status?t.json().then((function(t){t.sort(),_(t)})):console.log("Sorry, something went wrong ("+t.status+")")})).catch((function(t){console.log(t)}))},Jt=function(t){fetch(a.dataSamples[t].geoJsonUrl,{method:"GET",headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json; charset=utf-8"}}).then((function(t){200===t.status?t.json().then((function(t){et(t)})):console.log("Sorry, something went wrong ("+t.status+")")})).catch((function(t){console.log(t)}))},Gt=function(){return 60*Z*1e3},qt=function(e){null==e&&(e=[]);var n=e.map((function(t){return t.value})),i=H.length>n.length;U(n),t.highlightedNodes=n,C(t),i&&Bt()},Bt=function(){kt(Object.assign([],yt))},Rt=function(){zt({width:window.innerWidth,height:window.innerHeight})},zt=function(t){Et(Object.assign({},At,t))},Zt=function(t){P(t)},Wt=a.dataSamples.map((function(t,e){return{value:e,label:t.title}})),Xt=Y.map((function(t){return{value:t,label:t}})),Qt=H.map((function(t){return{value:t,label:t}})),Yt=Object(j.jsx)("span",{});null==yt&&(Yt=Object(j.jsx)(O,{}));var _t=null;null!=rt&&(_t=Object(j.jsx)(c.a,{longitude:rt.geometry.coordinates[0],latitude:rt.geometry.coordinates[1],closeButton:!1,closeOnClick:!1,anchor:"bottom-left",children:Object(j.jsxs)("div",{className:"popup-inner",children:[a.nodeLabel," ",null!=rt.properties?rt.properties.name:""]})}));var Kt=null;return a.dataSamples.length>1&&(Kt=Object(j.jsxs)("div",{children:[Object(j.jsx)("h6",{children:"Select Data"}),Object(j.jsx)("div",{children:Object(j.jsx)(y.a,{options:Wt,onChange:function(e){if(null!=e&&u!==e.value){qt([]);var n=e.value;window.history.pushState({},"",""),kt(null),h(n),Ht(n),Ut(n),Jt(n),zt(a.dataSamples[n].initialPartialViewport),t.dataSampleIdx=n,C(t)}},value:Wt[u]})})]})),Object(j.jsxs)("div",{id:"container",children:[Yt,Object(j.jsx)("div",{id:"divdeckgl",children:Object(j.jsxs)(c.b,Object(s.a)(Object(s.a)({},At),{},{mapStyle:a.mapboxStyle,dragRotate:!0,onViewportChange:zt,mapboxApiAccessToken:a.mapboxToken,children:[Object(j.jsx)(p,{color:a.color,handleOnHover:function(t){ct(null!==t?t.object:null)},highlightColor:a.highlightColor,highlightedNodes:H,initialViewState:a.initialViewport,loopLength:q,loopTimeMinutes:Z,nodes:tt,timestampOffset:bt,trips:yt,trailLength:Lt,viewport:At}),_t]}))}),Object(j.jsxs)("div",{id:"top-left-container",children:[Object(j.jsx)("div",{id:"title-box",children:Object(j.jsx)("h1",{children:b})}),Object(j.jsxs)("div",{id:"divinfo",className:F?"hide":"",children:[Object(j.jsx)("button",{id:"btnHideInfoBox",className:"btn-transparent right-align",onClick:function(){return Zt(!0)},children:"X"}),Kt,Object(j.jsx)("h3",{children:I}),Object(j.jsxs)("div",{children:[Object(j.jsx)("h6",{children:"Adjust point in time"}),Object(j.jsx)("input",{className:"full-width",type:"range",min:"0",max:"100",value:String(at),onChange:function(t){var e=Date.now()-bt,n=Gt(),i=e%n,a=t.target.value;ft(bt+(i-a/100*n))}})]}),Object(j.jsxs)("div",{children:[Object(j.jsx)("h6",{children:"Adjust loop time"}),Object(j.jsxs)("div",{className:"block",children:[Object(j.jsx)("input",{className:"",type:"number",defaultValue:String(Z),onInput:function(e){var n=e.target.value;if(null!=n&&n.length>0){var i=parseFloat(n);i<=0?i=1e-4:i>9999999&&(i=9999999);var l=Date.now()-bt,o=Gt(),s=60*i*1e3;ft(bt+(l%s-s*(l%o/o))),W(i),t.loopTime=i,C(t)}else W(a.initialLoopTimeMinutes),t.trailLength=null,C(t)}}),Object(j.jsx)("label",{children:"mins"})]})]}),Object(j.jsxs)("div",{children:[Object(j.jsx)("h6",{children:"Adjust trail length"}),Object(j.jsxs)("div",{className:"block",children:[Object(j.jsx)("input",{type:"number",defaultValue:String(Lt),onInput:function(e){var n=e.target.value;if(null!=n&&n.length>0){var i=parseFloat(n);i<=0?i=1e-4:i>9999999&&(i=9999999),Tt(i),t.trailLength=i,C(t)}else Tt(a.initialTrailLength),t.trailLength=null,C(t)}}),Object(j.jsx)("label",{children:"x"})]})]}),Object(j.jsxs)("div",{children:[Object(j.jsxs)("h6",{children:["Highlight ",a.nodeLabelPlural]}),Object(j.jsx)("div",{children:Object(j.jsx)(y.a,{closeMenuOnSelect:!1,isMulti:!0,options:Xt,onChange:qt,onMenuClose:Bt,placeholder:"Highlight "+a.nodeLabelPlural,value:Qt})})]})]}),Object(j.jsx)("button",{id:"btnShowInfoBox",className:"btn-transparent "+(F?"":"hide"),onClick:function(){return Zt(!1)},children:"SHOW INFO BOX"})]})]})},D=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,222)).then((function(e){var n=e.getCLS,i=e.getFID,a=e.getFCP,l=e.getLCP,o=e.getTTFB;n(t),i(t),a(t),l(t),o(t)}))};o.a.render(Object(j.jsx)(a.a.StrictMode,{children:Object(j.jsx)(M,{})}),document.getElementById("root")),D()}},[[202,1,2]]]);
//# sourceMappingURL=main.94adb254.chunk.js.map