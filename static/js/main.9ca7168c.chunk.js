(this["webpackJsonpdeckgl-trips"]=this["webpackJsonpdeckgl-trips"]||[]).push([[0],{126:function(e,t){},167:function(e,t,n){},185:function(e,t){},190:function(e,t,n){},191:function(e,t,n){},199:function(e,t,n){},200:function(e,t,n){},203:function(e,t,n){"use strict";n.r(t);var i=n(1),a=n.n(i),l=n(89),o=n.n(l),c=(n(167),n(11)),r=n(33),s=n(6),u=n(127),h=n(213),d=n(220),j=n(218),p=n(14),g=function(e){var t=Object(i.useState)(0),n=Object(s.a)(t,2),a=n[0],l=n[1],o=Object(i.useState)({id:0}),c=Object(s.a)(o,1)[0];Object(i.useEffect)((function(){return c.id=window.requestAnimationFrame((function t(){if(null!=e.loopLength){var n=Date.now()-e.timestampOffset,i=60*e.loopTimeMinutes*1e3;l(n%i*(e.loopLength/i))}c.id=window.requestAnimationFrame(t)})),function(){return window.cancelAnimationFrame(c.id)}}),[c,e.loopLength,e.timestampOffset,e.loopTimeMinutes]);var r=Object(i.useCallback)((function(t){var n=e.color,i=t.color;return null!=i&&(n=i),null!=t.nodes&&e.highlightedNodes.length>0&&t.nodes.forEach((function(t){null!=e.highlightedNodes.find((function(e){return t.toLowerCase()===e.toLowerCase()}))&&(n=e.highlightColor)})),n}),[e.color,e.highlightColor,e.highlightedNodes]),u=[];return null!=e.trips&&u.push(new h.a({id:"trips",data:e.trips,getPath:function(e){return e.segments.map((function(e){return e.coordinates}))},getTimestamps:function(e){return e.segments.map((function(e){return e.timestamp}))},getColor:r,opacity:.3,widthMinPixels:2,trailLength:e.trailLength,currentTime:a})),null!=e.nodes&&u.push(new d.a({id:"geojson-layer",data:e.nodes,filled:!0,getFillColor:function(){return[0,255,178,150]},stroked:!0,extruded:!1,pointRadiusScale:100,getRadius:function(){return.4},pickable:!0,autoHighlight:!0,highlightColor:[0,255,178,250],onHover:e.handleOnHover,onClick:function(e){return console.log(e.object.properties.name)}})),0===u.length?null:Object(p.jsx)(j.a,{initialViewState:e.initialViewState,viewState:e.viewport,layers:u})},b=n(128),f=(n(190),n(191),function(e){var t=e.handleLoopTimeMinutes,n=e.handleTimestampOffset,a=e.handleTrailLength,l=e.handleDataChange,o=e.handleHighlightedNodes,c=e.reloadTrips,r=Object(i.useState)(""),u=Object(s.a)(r,2),h=u[0],d=u[1],j=Object(i.useState)(!1),g=Object(s.a)(j,2),f=g[0],O=g[1],m=Object(i.useState)(0),v=Object(s.a)(m,2),x=v[0],S=v[1],w=Object(i.useState)(!1),L=Object(s.a)(w,2),N=L[0],T=L[1];Object(i.useEffect)((function(){var e=setInterval((function(){return T((function(e){return!e}))}),1e6);return function(){clearInterval(e)}}),[]),Object(i.useEffect)((function(){if(null!=e.startDate){var t=Date.now()-e.timestampOffset,n=60*e.loopTimeMinutes*1e3,i=t%n,a=Math.floor(i/n*100),l=function(t){var n=t/e.timeMultiplier,i=new Date(e.startDate.getTime()+1e3*n),a=String(i.getMinutes());return a.length<2&&(a="0"+a),i.getDate()+"/"+(i.getMonth()+1)+"/"+i.getFullYear()+" "+i.getHours()+":"+a}(Math.floor(i*(e.loopLength/n)));d(l),S(a)}}),[N,e.timestampOffset,e.loopLength,e.loopTimeMinutes,e.startDate,e.timeMultiplier]);var C=Object(i.useCallback)((function(){return 60*e.loopTimeMinutes*1e3}),[e.loopTimeMinutes]),M=Object(i.useCallback)((function(t){var i=Date.now()-e.timestampOffset,a=C(),l=i%a,o=t.target.value/100*a,c=e.timestampOffset+(l-o);n(c)}),[C,e.timestampOffset,n]),k=Object(i.useCallback)((function(t){var n=t.target.value;if(null!=n&&n.length>0){var i=parseFloat(n);i<=0?i=1e-4:i>9999999&&(i=9999999),a(i)}else a(e.appConfig.initialTrailLength)}),[a,e.appConfig.initialTrailLength]),y=Object(i.useCallback)((function(i){var a=i.target.value;if(null!=a&&a.length>0){var l=parseFloat(a);l<=0?l=1e-4:l>9999999&&(l=9999999);var o=Date.now()-e.timestampOffset,c=C(),r=60*l*1e3,s=e.timestampOffset+(o%r-r*(o%c/c));n(s),t(l)}else t(e.appConfig.initialLoopTimeMinutes)}),[C,n,t,e.timestampOffset,e.appConfig.initialLoopTimeMinutes]),I=Object(i.useCallback)((function(t){null==t&&(t=[]);var n=t.map((function(e){return e.value})),i=e.highlightedNodes.length>n.length;o(n),i&&c()}),[o,c,e.highlightedNodes]),D=Object(i.useCallback)((function(e){null!=e&&(I([]),l(e.value))}),[I,l]),E=function(e){O(e)},H=e.appConfig.dataSamples.map((function(e,t){return{value:t,label:e.title}})),F=e.nodeList.map((function(e){return{value:e,label:e}})),V=e.highlightedNodes.map((function(e){return{value:e,label:e}})),A=null;return e.appConfig.dataSamples.length>1&&(A=Object(p.jsxs)("div",{children:[Object(p.jsx)("h6",{children:"Select Data"}),Object(p.jsx)("div",{children:Object(p.jsx)(b.a,{options:H,onChange:D,value:H[e.dataSampleIdx]})})]})),Object(p.jsxs)("div",{id:"top-left-container",children:[Object(p.jsx)("div",{id:"title-box",children:Object(p.jsx)("h1",{children:e.friendlyName})}),Object(p.jsxs)("div",{id:"divinfo",className:f?"hide":"",children:[Object(p.jsx)("button",{id:"btnHideInfoBox",className:"btn-transparent right-align",onClick:function(){return E(!0)},children:"X"}),A,Object(p.jsx)("h3",{children:h}),Object(p.jsxs)("div",{children:[Object(p.jsx)("h6",{children:"Adjust point in time"}),Object(p.jsx)("input",{className:"full-width",type:"range",min:"0",max:"100",value:String(x),onChange:M})]}),Object(p.jsxs)("div",{children:[Object(p.jsx)("h6",{children:"Adjust loop time"}),Object(p.jsxs)("div",{className:"block",children:[Object(p.jsx)("input",{className:"",type:"number",value:String(e.loopTimeMinutes),onInput:y}),Object(p.jsx)("label",{children:"mins"})]})]}),Object(p.jsxs)("div",{children:[Object(p.jsx)("h6",{children:"Adjust trail length"}),Object(p.jsxs)("div",{className:"block",children:[Object(p.jsx)("input",{type:"number",value:String(e.trailLength),onInput:k}),Object(p.jsx)("label",{children:"x"})]})]}),Object(p.jsxs)("div",{children:[Object(p.jsxs)("h6",{children:["Highlight ",e.appConfig.nodeLabelPlural]}),Object(p.jsx)("div",{children:Object(p.jsx)(b.a,{closeMenuOnSelect:!1,isMulti:!0,options:F,onChange:I,onMenuClose:e.reloadTrips,placeholder:"Highlight "+e.appConfig.nodeLabelPlural,value:V})})]})]}),Object(p.jsx)("button",{id:"btnShowInfoBox",className:"btn-transparent "+(f?"":"hide"),onClick:function(){return E(!1)},children:"SHOW INFO BOX"})]})}),O=n(3),m=n(2),v=n(8),x=n(153),S=(n(199),function(e){Object(v.a)(n,e);var t=Object(x.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"render",value:function(){return Object(p.jsx)("div",{className:"spinner-container",children:Object(p.jsxs)("div",{className:"spinner",children:[Object(p.jsx)("div",{className:"spinner-circle spinner-circle-outer"}),Object(p.jsx)("div",{className:"spinner-circle spinner-circle-inner"}),Object(p.jsx)("div",{className:"spinner-circle spinner-circle-single-1"}),Object(p.jsx)("div",{className:"spinner-circle spinner-circle-single-2"}),Object(p.jsx)("div",{className:"text",children:"Loading"})]})})}}]),n}(i.Component));function w(e){return new URL(window.location.href).searchParams.get(e)}function L(e){if(null!=e){var t=Number(e);if(!Number.isNaN(t))return t}return null}var N="dataIdx",T="loopTime",C="trailLength",M="highlightNodes";function k(e,t,n){for(var i=e.length>0?e.split("&"):[],a=!1,l=0;l<i.length;l++){i[l].split("=")[0]===t&&(i[l]=t+"="+(n||""),a=!0)}return!1===a&&i.push(t+"="+(n||"")),i.join("&")}n(200),n(201);var y={color:[255,235,86],colors:[[255,109,245],[0,255,119]],dataSamples:[],highlightColor:[255,109,245],initialLoopTimeMinutes:1,initialTrailLength:100,initialViewport:{latitude:19.045632,longitude:68.538902,zoom:3,maxZoom:20,pitch:45,bearing:0,width:500,height:500},mapboxStyle:"mapbox://styles/mapbox/dark-v10",nodeLabel:"Node",nodeLabelPlural:"Nodes",title:"Trips"},I=function(){return{width:window.innerWidth,height:window.innerHeight}},D=function(){var e=Object(i.useState)(function(){var e={dataSampleIdx:null,loopTime:null,trailLength:null,highlightedNodes:null},t=L(w(N));null!=t&&t>=0&&(e.dataSampleIdx=t);var n=L(w(T));null!=n&&n>0&&n<999999&&(e.loopTime=n);var i=L(w(C));null!=i&&i>0&&i<999999&&(e.trailLength=i);var a=w(M);return null!=a&&a.length>0&&(e.highlightedNodes=a.split(",")),e}()),t=Object(s.a)(e,2),n=t[0],a=t[1],l=Object(i.useState)(y),o=Object(s.a)(l,2),h=o[0],d=o[1],j=Object(i.useState)(n.dataSampleIdx||-1),b=Object(s.a)(j,2),O=b[0],m=b[1],v=Object(i.useState)(""),x=Object(s.a)(v,2),D=x[0],E=x[1],H=Object(i.useState)(null!=n.highlightedNodes?n.highlightedNodes:[]),F=Object(s.a)(H,2),V=F[0],A=F[1],P=Object(i.useState)(1e3),J=Object(s.a)(P,2),B=J[0],G=J[1],R=Object(i.useState)(n.loopTime||y.initialLoopTimeMinutes),U=Object(s.a)(R,2),Z=U[0],q=U[1],z=Object(i.useState)([]),W=Object(s.a)(z,2),X=W[0],Y=W[1],_=Object(i.useState)(null),K=Object(s.a)(_,2),Q=K[0],$=K[1],ee=Object(i.useState)(null),te=Object(s.a)(ee,2),ne=te[0],ie=te[1],ae=Object(i.useState)(new Date(2e3,1,1,0,0,0)),le=Object(s.a)(ae,2),oe=le[0],ce=le[1],re=Object(i.useState)(Date.now()),se=Object(s.a)(re,2),ue=se[0],he=se[1],de=Object(i.useState)(1),je=Object(s.a)(de,2),pe=je[0],ge=je[1],be=Object(i.useState)(n.trailLength||y.initialTrailLength),fe=Object(s.a)(be,2),Oe=fe[0],me=fe[1],ve=Object(i.useState)(null),xe=Object(s.a)(ve,2),Se=xe[0],we=xe[1],Le=Object(i.useState)(Object(r.a)({},y.initialViewport)),Ne=Object(s.a)(Le,2),Te=Ne[0],Ce=Ne[1];Object(i.useEffect)((function(){var e=function(){return Ce((function(e){return Object(r.a)(Object(r.a)({},e),I())}))};return window.addEventListener("resize",e),fetch("app-settings.json",{method:"GET",headers:{Accept:"application/json; charset=utf-8"}}).then((function(e){200===e.status?e.json().then((function(e){d((function(t){return Object(r.a)(Object(r.a)({},t),e)}))})):console.log("Sorry, could not load config ("+e.status+")")})).catch((function(e){console.log(e)})),function(){return window.removeEventListener("resize",e)}}),[]),Object(i.useEffect)((function(){q(n.loopTime||h.initialLoopTimeMinutes),me(n.trailLength||h.initialTrailLength)}),[n,h]),Object(i.useEffect)((function(){var e;h.dataSamples.length>0&&(O<=-1?m(0):(a((function(e){return Object(r.a)(Object(r.a)({},e),{},{dataSampleIdx:O})})),m(O),function(e){var t=h.dataSamples[e].tripsUrl;fetch(t).then((function(e){200===e.status?e.json().then((function(e){var t=h.title;null!=e.friendlyName&&(t=e.friendlyName);var n=Number(e.startTimestamp)?new Date(1e3*e.startTimestamp):new Date(Date.parse(e.startTimestamp)),i=e.timeMultiplier,a=e.trips,l=e.loopLength;if(a.length>0&&a.length<=10)for(var o=0;o<a.length;o++)a[o].color=h.colors[o%h.colors.length];ce(n),he(Date.now()),E(t),we(a),G(l),ge(i)})):console.log("Something went wrong loading trips ("+e.status+")")})).catch((function(e){console.log(e)}))}(O),e=O,fetch(h.dataSamples[e].nodeListUrl).then((function(e){200===e.status?e.json().then((function(e){e.sort(),Y(e)})):console.log("Something went wrong loading node list ("+e.status+")")})).catch((function(e){console.log(e)})),function(e){fetch(h.dataSamples[e].geoJsonUrl).then((function(e){200===e.status?e.json().then((function(e){$(e)})):console.log("Something went wrong loading GeoJSON nodes ("+e.status+")")})).catch((function(e){console.log(e)}))}(O),Ce((function(e){return Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)({},e),h.initialViewport),h.dataSamples[O].initialPartialViewport),I())}))))}),[O,h]),Object(i.useEffect)((function(){window.history.pushState({},"",""),function(e){var t=decodeURIComponent(window.location.search.substring(1));null!=e.dataSampleIdx&&(t=k(t,N,String(e.dataSampleIdx))),null!=e.loopTime&&(t=k(t,T,String(e.loopTime))),null!=e.trailLength&&(t=k(t,C,String(e.trailLength))),null!=e.highlightedNodes&&(t=k(t,M,e.highlightedNodes.join(",")));var n="?"+t;window.history.pushState({},"",n)}(n)}),[n]);var Me=Object(p.jsx)("span",{});null==Se&&(Me=Object(p.jsx)(S,{}));var ke=null;return null!=ne&&(ke=Object(p.jsx)(u.a,{longitude:ne.geometry.coordinates[0],latitude:ne.geometry.coordinates[1],closeButton:!1,closeOnClick:!1,anchor:"bottom-left",children:Object(p.jsxs)("div",{className:"popup-inner",children:[h.nodeLabel," ",null!=ne.properties?ne.properties.name:""]})})),Object(p.jsxs)("div",{id:"container",children:[Me,Object(p.jsx)("div",{id:"divdeckgl",children:Object(p.jsxs)(u.b,Object(r.a)(Object(r.a)({},Te),{},{mapStyle:h.mapboxStyle,dragRotate:!0,onViewportChange:function(e){Ce((function(t){return Object(r.a)(Object(r.a)(Object(r.a)({},t),e),I())}))},mapboxApiAccessToken:"pk.eyJ1Ijoic3RldmVqayIsImEiOiJja24ya3dvZGMxOGZhMnZtbG9lOGJkem44In0.5vrcHDx_DfpxCXSLWwi4Ng",children:[Object(p.jsx)(g,{color:h.color,handleOnHover:function(e){ie(null!==e?e.object:null)},highlightColor:h.highlightColor,highlightedNodes:V,initialViewState:h.initialViewport,loopLength:B,loopTimeMinutes:Z,nodes:Q,timestampOffset:ue,trips:Se,trailLength:Oe,viewport:Te}),ke]}))}),Object(p.jsx)(f,{appConfig:h,dataSampleIdx:O,friendlyName:D,handleDataChange:function(e){m(e)},highlightedNodes:V,handleHighlightedNodes:function(e){A(e),a((function(t){return Object(r.a)(Object(r.a)({},t),{},{highlightedNodes:e})}))},loopLength:B,loopTimeMinutes:Z,handleLoopTimeMinutes:function(e){q(e),a((function(t){return Object(r.a)(Object(r.a)({},t),{},{loopTime:e})}))},nodeList:X,startDate:oe,timestampOffset:ue,handleTimestampOffset:function(e){he(e)},timeMultiplier:pe,trailLength:Oe,handleTrailLength:function(e){me(e),a((function(t){return Object(r.a)(Object(r.a)({},t),{},{trailLength:e})}))},reloadTrips:function(){we((function(e){return e?Object(c.a)(e):null}))}})]})},E=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,223)).then((function(t){var n=t.getCLS,i=t.getFID,a=t.getFCP,l=t.getLCP,o=t.getTTFB;n(e),i(e),a(e),l(e),o(e)}))},H=n(100);n.n(H).a.workerClass=n(202).default,o.a.render(Object(p.jsx)(a.a.StrictMode,{children:Object(p.jsx)(D,{})}),document.getElementById("root")),E()}},[[203,1,2]]]);
//# sourceMappingURL=main.9ca7168c.chunk.js.map