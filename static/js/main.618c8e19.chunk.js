(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{134:function(e,t,n){e.exports=n(151)},139:function(e,t,n){},143:function(e,t){},146:function(e,t,n){},147:function(e,t,n){},148:function(e,t,n){},151:function(e,t,n){"use strict";n.r(t);var a=n(4),i=n.n(a),l=n(45),o=n.n(l),r=(n(139),n(1)),s=n(2),h=n(5),u=n(3),p=n(8),d=n(6),m=n(107),c=n(100),g=n(157),f=n(158),v=n(159),S={name:"Default",defaultTitle:"Trips",dataSamples:[{title:"SE QLD Transport",tripsUrl:"data/south-east-qld/trips.json",geoJsonUrl:"data/south-east-qld/geojson-stops.json",stopListUrl:"data/south-east-qld/stops-list.json",getInitialPartialViewport:function(){return{latitude:-27.44,longitude:153.05,zoom:11}}},{title:"SC Transport",tripsUrl:"data/sunshine-coast/trips.json",geoJsonUrl:"data/sunshine-coast/geojson-stops.json",stopListUrl:"data/sunshine-coast/stops-list.json",getInitialPartialViewport:function(){return{latitude:-26.65,longitude:153.02,zoom:10}}}],mapboxStyle:"mapbox://styles/stevejk/cjyvgdhr610m71cs03b5z7y9t",color:[23,184,190],colors:[[0,255,246],[255,235,86],[255,109,245],[0,255,119]],highlightColor:[253,128,93],defaultLoopTimeMinutes:1,defaultTrailLength:100,mapboxToken:"pk.eyJ1Ijoic3RldmVqayIsImEiOiJjanl2aDBiZ2kwZDBnM2lycnN3cWpoZGJlIn0.-POx84S1T6CybWoHT069Iw",getInitialViewport:function(){return{latitude:-27.44,longitude:153.05,zoom:11,maxZoom:20,pitch:45,bearing:0,width:500,height:500}}},w=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(h.a)(this,Object(u.a)(t).call(this,e)))._animationFrame=void 0,n.intervalId=void 0,n.state={currentTime:0},n._animationFrame=null,n.getColor=n.getColor.bind(Object(p.a)(n)),n}return Object(d.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this;this._animate(),this.intervalId=setInterval(function(){return e.props.periodicTripUpdateCallback()},500)}},{key:"componentWillUnmount",value:function(){null!=this._animationFrame&&window.cancelAnimationFrame(this._animationFrame),clearInterval(this.intervalId)}},{key:"getColor",value:function(e){var t=S.color,n=e.color;if(null!=n&&(t=n),null!=S.highlightColor&&null!=e.stops&&this.props.highlightedStops.length>0){var a=this;e.stops.forEach(function(e){null!=a.props.highlightedStops.find(function(t){return e.toLowerCase()===t.toLowerCase()})&&(t=S.highlightColor)})}return t}},{key:"_animate",value:function(){if(null!=this.props.loopLength){var e=Date.now()-this.props.timestampOffset,t=this.props.loopTimeMilliseconds;this.setState({currentTime:e%t*(this.props.loopLength/t)})}this._animationFrame=window.requestAnimationFrame(this._animate.bind(this))}},{key:"render",value:function(){var e=this.props,t=e.trips,n=e.trailLength,i=e.stops,l=e.handleOnHover,o=e.viewport,r=this.state.currentTime,s=[];return null!=t&&s.push(new g.a({id:"trips",data:t,getPath:function(e){return e.segments.map(function(e){return e.coordinates})},getTimestamps:function(e){return e.segments.map(function(e){return e.timestamp})},getColor:this.getColor,opacity:.3,widthMinPixels:2,trailLength:n,currentTime:r})),null!=i&&s.push(new f.a({id:"geojson-layer",data:i,filled:!0,getFillColor:function(e){return[0,255,178,150]},stroked:!0,extruded:!1,pointRadiusScale:100,getRadius:function(e){return.4},pickable:!0,autoHighlight:!0,highlightColor:[0,255,178,250],onHover:l,onClick:function(e){return console.log(e.object.properties.name)}})),0===s.length?null:a.createElement(v.a,{initialViewState:S.getInitialViewport(),viewState:o,layers:s})}}]),t}(a.Component),b=(n(146),function(e){function t(){return Object(r.a)(this,t),Object(h.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return a.createElement("div",{className:"spinner-container"},a.createElement("div",{className:"spinner"},a.createElement("div",{className:"spinner-circle spinner-circle-outer"}),a.createElement("div",{className:"spinner-circle spinner-circle-inner"}),a.createElement("div",{className:"spinner-circle spinner-circle-single-1"}),a.createElement("div",{className:"spinner-circle spinner-circle-single-2"}),a.createElement("div",{className:"text"},"Loading")))}}]),t}(a.Component));function T(e){return new URL(window.location.href).searchParams.get(e)}function L(e){if(null!=e){var t=Number(e);if(!Number.isNaN(t))return t}return null}function k(e,t,n){for(var a=e.length>0?e.split("&"):[],i=!1,l=0;l<a.length;l++){a[l].split("=")[0]===t&&(a[l]=t+"="+(n||""),i=!0)}return!1===i&&a.push(t+"="+(n||"")),a.join("&")}var y={getKnownUrlParameters:function(){var e={dataSampleIdx:null,loopTime:null,trailLength:null,highlightedStops:null},t=L(T("dataIdx"));null!=t&&t>=0&&(e.dataSampleIdx=t);var n=L(T("loopTime"));null!=n&&n>0&&n<999999&&(e.loopTime=n);var a=L(T("trailLength"));null!=a&&a>0&&a<999999&&(e.trailLength=a);var i=T("highlightStops");return null!=i&&i.length>0&&(e.highlightedStops=i.split(",")),e},updateUrlParameters:function(e){var t=decodeURIComponent(window.location.search.substring(1));null!=e.dataSampleIdx&&(t=k(t,"dataIdx",String(e.dataSampleIdx))),null!=e.loopTime&&(t=k(t,"loopTime",String(e.loopTime))),null!=e.trailLength&&(t=k(t,"trailLength",String(e.trailLength))),null!=e.highlightedStops&&(t=k(t,"highlightStops",e.highlightedStops.join(",")));var n="?"+t;window.history.pushState({},"",n)}},C=n(106),O=(n(147),n(148),n(149),function(e){function t(e){var n;Object(r.a)(this,t),(n=Object(h.a)(this,Object(u.a)(t).call(this,e))).timestampOffset=void 0,n.knownUrlParams=void 0,n.highlighedStopsChangedBeforeReload=void 0,n.knownUrlParams=y.getKnownUrlParameters();var a=n.knownUrlParams.dataSampleIdx||0;return n.state={friendlyName:"",startDate:new Date(2e3,1,1,0,0,0),trips:null,loopLength:1e3,loopTimeMinutes:n.knownUrlParams.loopTime||S.defaultLoopTimeMinutes,timeMultiplier:1,friendlyTime:"",trailLength:n.knownUrlParams.trailLength||S.defaultTrailLength,percentThroughLoop:0,highlightedStops:null!=n.knownUrlParams.highlightedStops?n.knownUrlParams.highlightedStops:[],dataSampleIdx:a,stopList:[],stops:null,popupInfo:null,viewport:Object.assign({},S.getInitialViewport(),S.dataSamples[a].getInitialPartialViewport())},n.timestampOffset=Date.now(),n.highlighedStopsChangedBeforeReload=!1,n.handleDataChange=n.handleDataChange.bind(Object(p.a)(n)),n.handleHighlightStopChange=n.handleHighlightStopChange.bind(Object(p.a)(n)),n.handleHighlightStopReload=n.handleHighlightStopReload.bind(Object(p.a)(n)),n.handleLoopTimeMinutesChange=n.handleLoopTimeMinutesChange.bind(Object(p.a)(n)),n.handleOnHoverGeoPoint=n.handleOnHoverGeoPoint.bind(Object(p.a)(n)),n.handleTimeChange=n.handleTimeChange.bind(Object(p.a)(n)),n.handleTrailLengthChange=n.handleTrailLengthChange.bind(Object(p.a)(n)),n.loadTrips=n.loadTrips.bind(Object(p.a)(n)),n.loadStopList=n.loadStopList.bind(Object(p.a)(n)),n.updateBoxInfo=n.updateBoxInfo.bind(Object(p.a)(n)),n}return Object(d.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.resize.bind(this)),this.resize(),this.loadTrips(this.state.dataSampleIdx),this.loadStopList(this.state.dataSampleIdx),this.loadGeoJsonStops(this.state.dataSampleIdx)}},{key:"componentWillUnmount",value:function(){}},{key:"loadTrips",value:function(e){var t=this,n=S.dataSamples[e].tripsUrl;Object(c.a)(n,function(e,n){if(null==e){var a=S.defaultTitle;null!=n.friendlyName&&(a=n.friendlyName);var i=new Date(Date.parse(n.startTimestamp)),l=n.timeMultiplier,o=n.trips,r=n.loopLength;if(o.length>0&&o.length<=10)for(var s=0;s<o.length;s++)o[s].color=S.colors[s%S.colors.length];t.timestampOffset=Date.now(),t.setState({friendlyName:a,startDate:i,trips:o,loopLength:r,timeMultiplier:l})}})}},{key:"loadStopList",value:function(e){var t=this;Object(c.a)(S.dataSamples[e].stopListUrl,function(e,n){if(null==e){var a=n;a.sort(),t.setState({stopList:a})}})}},{key:"loadGeoJsonStops",value:function(e){var t=this;Object(c.a)(S.dataSamples[e].geoJsonUrl,function(e,n){if(null==e){var a=n;t.setState({stops:a})}})}},{key:"getLoopTime",value:function(){return 60*this.state.loopTimeMinutes*1e3}},{key:"updateBoxInfo",value:function(){if(null!=this.state.startDate){var e=Date.now()-this.timestampOffset,t=this.getLoopTime(),n=e%t,a=Math.floor(n/t*100),i=0*this.state.timeMultiplier+Math.floor(n*(this.state.loopLength/t)),l=this.toFriendlyTime(i);this.setState({friendlyTime:l,percentThroughLoop:a})}}},{key:"toFriendlyTime",value:function(e){var t=e/this.state.timeMultiplier,n=new Date(this.state.startDate.getTime()+1e3*t),a=String(n.getMinutes());return a.length<2&&(a="0"+a),n.getDate()+"/"+(n.getMonth()+1)+"/"+n.getFullYear()+" "+n.getHours()+":"+a}},{key:"handleTimeChange",value:function(e){var t=Date.now()-this.timestampOffset,n=this.getLoopTime(),a=t%n,i=e.target.value/100*n,l=this.timestampOffset+(a-i);this.timestampOffset=l}},{key:"handleTrailLengthChange",value:function(e){var t=e.target.value;if(null!=t&&t.length>0){var n=parseFloat(t);n<=0?n=1e-4:n>9999999&&(n=9999999),this.setState({trailLength:n}),this.knownUrlParams.trailLength=n,y.updateUrlParameters(this.knownUrlParams)}else this.setState({trailLength:S.defaultTrailLength}),this.knownUrlParams.trailLength=null,y.updateUrlParameters(this.knownUrlParams)}},{key:"handleLoopTimeMinutesChange",value:function(e){var t=e.target.value;if(null!=t&&t.length>0){var n=parseFloat(t);n<=0?n=1e-4:n>9999999&&(n=9999999);var a=Date.now()-this.timestampOffset,i=this.getLoopTime(),l=60*n*1e3,o=this.timestampOffset+(a%l-l*(a%i/i));this.timestampOffset=o,this.setState({loopTimeMinutes:n}),this.knownUrlParams.loopTime=n,y.updateUrlParameters(this.knownUrlParams)}else this.setState({loopTimeMinutes:S.defaultLoopTimeMinutes}),this.knownUrlParams.trailLength=null,y.updateUrlParameters(this.knownUrlParams)}},{key:"handleHighlightStopChange",value:function(e,t){null==e&&(e=[]);var n=e.map(function(e){return e.value}),a=this.state.highlightedStops.length>n.length;this.state.highlightedStops.length!==n.length&&(this.highlighedStopsChangedBeforeReload=!0),this.setState({highlightedStops:n}),this.knownUrlParams.highlightedStops=n,y.updateUrlParameters(this.knownUrlParams),a&&this.handleHighlightStopReload()}},{key:"handleHighlightStopReload",value:function(){var e=this;if(!0===this.highlighedStopsChangedBeforeReload){var t=this.state.trips;this.setState({trips:null}),setTimeout(function(){e.highlighedStopsChangedBeforeReload=!1,e.setState({trips:t})},200)}}},{key:"handleDataChange",value:function(e,t){if(null!=e&&this.state.dataSampleIdx!==e.value){var n=e.value;window.history.pushState({},"",""),this.setState({trips:null,dataSampleIdx:n}),this.loadTrips(n),this.loadStopList(n),this.loadGeoJsonStops(n),this.handleViewportChange(S.dataSamples[n].getInitialPartialViewport()),this.knownUrlParams.dataSampleIdx=n,y.updateUrlParameters(this.knownUrlParams)}}},{key:"handleOnHoverGeoPoint",value:function(e){this.setState({popupInfo:null!==e?e.object:null})}},{key:"resize",value:function(){this.handleViewportChange({width:window.innerWidth,height:window.innerHeight})}},{key:"handleViewportChange",value:function(e){this.setState({viewport:Object.assign({},this.state.viewport,e)})}},{key:"render",value:function(){var e=this.state,t=e.friendlyName,n=e.trips,i=e.friendlyTime,l=e.loopLength,o=e.loopTimeMinutes,r=e.trailLength,s=e.percentThroughLoop,h=e.highlightedStops,u=e.stopList,p=e.dataSampleIdx,d=e.stops,c=e.popupInfo,g=e.viewport,f=S.dataSamples.map(function(e,t){return{value:t,label:e.title}}),v=u.map(function(e){return{value:e,label:e}}),T=h.map(function(e){return{value:e,label:e}}),L=a.createElement("span",null);null==n&&(L=a.createElement(b,null));var k=null;null!=c&&(k=a.createElement(m.a,{longitude:c.geometry.coordinates[0],latitude:c.geometry.coordinates[1],closeButton:!1,closeOnClick:!1,anchor:"bottom-left"},a.createElement("div",null,"Bus Stop ",null!=c.properties?c.properties.name:"")));var y=null;return S.dataSamples.length>1&&(y=a.createElement("div",null,a.createElement("h6",null,"Select Data"),a.createElement("div",null,a.createElement(C.a,{options:f,onChange:this.handleDataChange,value:f[p]})))),a.createElement("div",{id:"container"},L,a.createElement("div",{id:"divdeckgl"},a.createElement(m.b,Object.assign({},g,{mapStyle:S.mapboxStyle,dragRotate:!0,onViewportChange:this.handleViewportChange.bind(this),mapboxApiAccessToken:S.mapboxToken}),a.createElement(w,{handleOnHover:this.handleOnHoverGeoPoint,highlightedStops:h,loopLength:l,loopTimeMilliseconds:this.getLoopTime(),periodicTripUpdateCallback:this.updateBoxInfo,stops:d,timestampOffset:this.timestampOffset,trips:n,trailLength:r,viewport:g}),k)),a.createElement("div",{id:"top-left-container"},a.createElement("div",{id:"title-box"},a.createElement("h1",null,t)),a.createElement("div",{id:"divinfo"},y,a.createElement("h3",null,i),a.createElement("div",null,a.createElement("h6",null,"Adjust point in time"),a.createElement("input",{className:"full-width",type:"range",min:"0",max:"100",value:String(s),onChange:this.handleTimeChange})),a.createElement("div",null,a.createElement("h6",null,"Adjust loop time"),a.createElement("div",{className:"block"},a.createElement("input",{className:"",type:"number",defaultValue:String(o),onInput:this.handleLoopTimeMinutesChange}),a.createElement("label",null,"mins"))),a.createElement("div",null,a.createElement("h6",null,"Adjust trail length"),a.createElement("div",{className:"block"},a.createElement("input",{type:"number",defaultValue:String(r),onInput:this.handleTrailLengthChange}),a.createElement("label",null,"x"))),a.createElement("div",null,a.createElement("h6",null,"Highlight Stops"),a.createElement("div",null,a.createElement(C.a,{closeMenuOnSelect:!1,isMulti:!0,options:v,onChange:this.handleHighlightStopChange,onMenuClose:this.handleHighlightStopReload,placeholder:"Highlight stop(s)",value:T}))))))}}]),t}(a.Component));l.render(a.createElement(O,null),document.body.appendChild(document.createElement("div")));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(O,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[134,1,2]]]);
//# sourceMappingURL=main.618c8e19.chunk.js.map