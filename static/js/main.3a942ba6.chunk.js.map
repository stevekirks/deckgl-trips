{"version":3,"sources":["app-config.ts","deckgl-overlay.tsx","loader.tsx","utils.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["CURRENT_APP_CONFIG","name","defaultTitle","dataUrls","label","value","process","mapboxStyle","color","colors","highlightColor","defaultLoopTimeMinutes","defaultTrailLength","geoJsonUrl","stopListUrl","mapboxToken","getInitialViewport","latitude","longitude","zoom","maxZoom","pitch","bearing","width","height","DeckGLOverlay","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","_animationFrame","intervalId","state","currentTime","getColor","bind","assertThisInitialized","_this2","_animate","setInterval","periodicTripUpdateCallback","window","cancelAnimationFrame","clearInterval","d","tagColor","stops","highlightedStops","length","self","forEach","n","find","hn","toLowerCase","loopLength","timestamp","Date","now","timestampOffset","loopTime","loopTimeMilliseconds","setState","requestAnimationFrame","_this$props","trips","trailLength","handleOnHover","viewport","layers","push","TripsLayer","id","data","getPath","segments","map","p","coordinates","getTimestamps","opacity","widthMinPixels","GeoJsonLayer","filled","getFillColor","stroked","extruded","pointRadiusScale","getRadius","pickable","autoHighlight","onHover","onClick","info","console","log","object","properties","react","deckgl","initialViewState","viewState","React","Loader","className","getUrlParam","URL","location","href","searchParams","get","getNumber","numStr","numNum","Number","isNaN","updateKeyInString","keysString","sParam","sValue","sURLVariables","split","parameterUpdated","i","join","utils","getKnownUrlParameters","result","dataUrlIdx","dataIdx","highlightStops","updateUrlParameters","params","newStateStr","decodeURIComponent","search","substring","String","queryFilters","history","pushState","App","_React$Component","knownUrlParams","highlighedStopsChangedBeforeReload","Utils","friendlyName","startDate","loopTimeMinutes","timeMultiplier","friendlyTime","percentThroughLoop","stopList","popupInfo","handleDataChange","handleHighlightStopChange","handleHighlightStopReload","handleLoopTimeMinutesChange","handleOnHoverGeoPoint","handleTimeChange","handleTrailLengthChange","loadData","loadStopList","updateBoxInfo","inherits","createClass","key","addEventListener","_resize","loadGeoJsonStops","dayUrlIdx","url","requestJson","error","response","parse","startTimestamp","_this3","sort","_this4","getLoopTime","timeThroughLoop","Math","floor","timeSinceStart","calculatedFriendlyTime","toFriendlyTime","realTimeSinceStart","currentDate","getTime","minutes","getMinutes","getDate","getMonth","getFullYear","getHours","event","newTimeThroughLoop","target","newTimestampOffset","trailLengthStr","parseFloat","loopTimeMinutesStr","newLoopTime","highlightedStopsCommaSep","action","highlightedStopsRemoved","_this5","cacheTrips","setTimeout","dataUrl","findIndex","_onViewportChange","innerWidth","innerHeight","assign","_this$state","stopListOptions","highlightedStopsVl","loader","loader_Loader","popupEle","esm","geometry","closeButton","closeOnClick","anchor","selectDataEle","react_select_browser_esm","options","onChange","mapStyle","dragRotate","onViewportChange","mapboxApiAccessToken","deckgl_overlay_DeckGLOverlay","type","min","max","defaultValue","onInput","closeMenuOnSelect","isMulti","onMenuClose","placeholder","ReactDOM","App_App","document","body","appendChild","createElement","Boolean","hostname","match","render","react_default","a","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"wXAEaA,EAAgC,CACzCC,KAAM,UACNC,aAAc,oBACdC,SAAU,CACN,CACAC,MAAO,QACPC,MAAOC,oBAGXC,YAAaD,oDACbE,MAAO,CAAC,GAAI,IAAK,KACjBC,OAAQ,CACJ,CAAC,EAAG,IAAK,KACT,CAAC,IAAK,IAAK,IACX,CAAC,IAAK,IAAK,KACX,CAAC,EAAG,IAAK,MAEbC,eAAgB,CAAC,IAAK,IAAK,IAC3BC,uBAAwB,EACxBC,mBAAoB,IACpBC,WAAYP,0BACZQ,YAAaR,uBACbS,YAAaT,4FACbU,mBAAoB,WAChB,MAAO,CACHC,UAAW,MACXC,UAAW,OACXC,KAAM,GACNC,QAAS,GACTC,MAAO,GACPC,QAAS,EACTC,MAAO,IACPC,OAAQ,OC7BCC,cAKnB,SAAAA,EAAYC,GAAY,IAAAC,EAAA,OAAAC,OAAAC,EAAA,EAAAD,CAAAE,KAAAL,IACtBE,EAAAC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAH,GAAAQ,KAAAH,KAAMJ,KAJRQ,qBAGwB,EAAAP,EAFxBQ,gBAEwB,EAGtBR,EAAKS,MAAQ,CACXC,YAAa,GAGfV,EAAKO,gBAAkB,KAEvBP,EAAKW,SAAWX,EAAKW,SAASC,KAAdX,OAAAY,EAAA,EAAAZ,CAAAD,IATMA,mFAYJ,IAAAc,EAAAX,KAClBA,KAAKY,WACLZ,KAAKK,WAAaQ,YAAY,kBAAMF,EAAKf,MAAMkB,8BAA8B,oDAIjD,MAAxBd,KAAKI,iBACPW,OAAOC,qBAAqBhB,KAAKI,iBAElCa,cAAcjB,KAAKK,6CAGba,GACP,IAAIxC,EAAQR,EAAmBQ,MAE3ByC,EAAWD,EAAExC,MAKjB,GAJgB,MAAZyC,IACFzC,EAAQyC,GAG+B,MAArCjD,EAAmBU,gBAAqC,MAAXsC,EAAEE,OAC7CpB,KAAKJ,MAAMyB,iBAAiBC,OAAS,EAAG,CAC1C,IAAIC,EAAOvB,KACXkB,EAAEE,MAAMI,QAAQ,SAACC,GAC+E,MAA1FF,EAAK3B,MAAMyB,iBAAiBK,KAAK,SAACC,GAAD,OAAgBF,EAAEG,gBAAkBD,EAAGC,kBAC1ElD,EAAQR,EAAmBU,kBAMnC,OAAOF,qCAIP,GAA6B,MAAzBsB,KAAKJ,MAAMiC,WAAoB,CACjC,IAAMC,EAAYC,KAAKC,MAAQhC,KAAKJ,MAAMqC,gBACpCC,EAAWlC,KAAKJ,MAAMuC,qBAI5BnC,KAAKoC,SAAS,CACZ7B,YAAcuB,EAAYI,GAAalC,KAAKJ,MAAMiC,WAAaK,KAGnElC,KAAKI,gBAAkBW,OAAOsB,sBAAsBrC,KAAKY,SAASH,KAAKT,wCAGhE,IAAAsC,EACsDtC,KAAKJ,MAA3D2C,EADAD,EACAC,MAAOC,EADPF,EACOE,YAAapB,EADpBkB,EACoBlB,MAAOqB,EAD3BH,EAC2BG,cAAeC,EAD1CJ,EAC0CI,SAC1CnC,EAAeP,KAAKM,MAApBC,YAEHoC,EAAS,GAkCb,OAhCa,MAATJ,GACFI,EAAOC,KAAK,IAAIC,IAAW,CACzBC,GAAI,QACJC,KAAMR,EACNS,QAAS,SAAC9B,GAAD,OAAYA,EAAE+B,SAASC,IAAI,SAACC,GAAD,OAAYA,EAAEC,eAClDC,cAAe,SAACnC,GAAD,OAAYA,EAAE+B,SAASC,IAAI,SAACC,GAAD,OAAYA,EAAErB,aACxDtB,SAAUR,KAAKQ,SACf8C,QAAS,GACTC,eAAgB,EAChBf,cACAjC,iBAIS,MAATa,GACFuB,EAAOC,KAAK,IAAIY,IAAa,CAC3BV,GAAI,gBACJC,KAAM3B,EACNqC,QAAQ,EACRC,aAAc,SAACxC,GAAD,MAAY,CAAC,EAAG,IAAK,IAAK,MACxCyC,SAAS,EACTC,UAAU,EACVC,iBAAkB,IAClBC,UAAW,SAAC5C,GAAD,MAAY,IACvB6C,UAAU,EACVC,eAAe,EACfpF,eAAgB,CAAC,EAAG,IAAK,IAAK,KAC9BqF,QAASxB,EACTyB,QAAS,SAACC,GAAD,OAAeC,QAAQC,IAAIF,EAAKG,OAAOC,WAAWpG,UAIzC,IAAlBwE,EAAOrB,OACF,KAIPkD,EAAA,cAACC,EAAA,EAAD,CACEC,iBAAkBxG,EAAmBgB,qBACrCyF,UAAWjC,EACXC,OAAQA,WA/G2BiC,aCFtBC,2LAGjB,OAAOL,EAAA,qBAAKM,UAAU,qBAAoBN,EAAA,qBAAKM,UAAU,WACrDN,EAAA,qBAAKM,UAAU,wCACfN,EAAA,qBAAKM,UAAU,wCACfN,EAAA,qBAAKM,UAAU,2CACfN,EAAA,qBAAKM,UAAU,2CACfN,EAAA,qBAAKM,UAAU,QAAf,oBAR4BF,cCDpC,SAASG,EAAY5G,GAGnB,OAFU,IAAI6G,IAAIjE,OAAOkE,SAASC,MAClBC,aAAaC,IAAIjH,GAInC,SAASkH,EAAUC,GACjB,GAAc,MAAVA,EAAgB,CAClB,IAAIC,EAASC,OAAOF,GACpB,IAAKE,OAAOC,MAAMF,GAChB,OAAOA,EAGX,OAAO,KAQT,SAASG,EAAkBC,EAAoBC,EAAgBC,GAI7D,IAHA,IAAIC,EAAgBH,EAAWrE,OAAS,EAAIqE,EAAWI,MAAM,KAAO,GAEhEC,GAAmB,EACdC,EAAI,EAAGA,EAAIH,EAAcxE,OAAQ2E,IAAK,CACtBH,EAAcG,GAAGF,MAAM,KAEzB,KAAOH,IACtBE,EAAcG,GAAKL,EAAO,KAAKC,GAAQ,IACvCG,GAAmB,GAO3B,OAJyB,IAArBA,GACAF,EAAclD,KAAKgD,EAAO,KAAKC,GAAQ,KAGpCC,EAAcI,KAAK,KAGb,IAAAC,EAAA,CACbC,sBADa,WAEX,IAAIC,EAA6B,CAC/BC,WAAY,KACZpE,SAAU,KACVM,YAAa,KACbnB,iBAAkB,MAIhBkF,EAAUlB,EAAUN,EAlCL,YAmCJ,MAAXwB,GAAmBA,GAAW,IAChCF,EAAOC,WAAaC,GAItB,IAAIrE,EAAWmD,EAAUN,EAvCN,aAwCH,MAAZ7C,GAAoBA,EAAW,GAAKA,EAAW,SACjDmE,EAAOnE,SAAWA,GAIpB,IAAIM,EAAc6C,EAAUN,EA5CN,gBA6CH,MAAfvC,GAAuBA,EAAc,GAAKA,EAAc,SAC1D6D,EAAO7D,YAAcA,GAIvB,IAAIgE,EAAiBzB,EAjDI,kBAsDzB,OAJsB,MAAlByB,GAA0BA,EAAelF,OAAS,IACpD+E,EAAOhF,iBAAmBmF,EAAeT,MAAM,MAG1CM,GAGTI,oBApCa,SAoCOC,GAClB,IAAIC,EAAcC,mBAAmB7F,OAAOkE,SAAS4B,OAAOC,UAAU,IAC7C,MAArBJ,EAAOJ,aACTK,EAAcjB,EAAkBiB,EA/Df,UA+D4CI,OAAOL,EAAOJ,cAEtD,MAAnBI,EAAOxE,WACTyE,EAAcjB,EAAkBiB,EAjEf,WAiE4CI,OAAOL,EAAOxE,YAEnD,MAAtBwE,EAAOlE,cACTmE,EAAcjB,EAAkBiB,EAnEZ,cAmE4CI,OAAOL,EAAOlE,eAEjD,MAA3BkE,EAAOrF,mBACTsF,EAAcjB,EAAkBiB,EArET,iBAqE4CD,EAAOrF,iBAAiB6E,KAAK,OAGlG,IAAIc,EAAe,IAAML,EACzB5F,OAAOkG,QAAQC,UAAU,GAAI,GAAIF,cC9ExBG,wBAAb,SAAAC,GAME,SAAAD,EAAYvH,GAAY,IAAAC,EAAA,OAAAC,OAAAC,EAAA,EAAAD,CAAAE,KAAAmH,IACtBtH,EAAAC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAqH,GAAAhH,KAAAH,KAAMJ,KALRqC,qBAIwB,EAAApC,EAHxBwH,oBAGwB,EAAAxH,EAFxByH,wCAEwB,EAGtBzH,EAAKwH,eAAiBE,EAAMnB,wBAE5BvG,EAAKS,MAAQ,CACXkH,aAAc,GACdC,UAAW,IAAI1F,KAAK,IAAM,EAAG,EAAG,EAAG,EAAG,GACtCQ,MAAO,KACPV,WAAY,IACZ6F,gBAAiB7H,EAAKwH,eAAenF,UAAYhE,EAAmBW,uBACpE8I,eAAgB,EAChBC,aAAc,GACdpF,YAAa3C,EAAKwH,eAAe7E,aAAetE,EAAmBY,mBACnE+I,mBAAoB,EACpBxG,iBAA0D,MAAxCxB,EAAKwH,eAAehG,iBAA2BxB,EAAKwH,eAAehG,iBAAmB,GACxGiF,WAAYzG,EAAKwH,eAAef,YAAc,EAC9CwB,SAAU,GACV1G,MAAO,KACP2G,UAAW,KACXrF,SAAUxE,EAAmBgB,sBAG/BW,EAAKoC,gBAAkBF,KAAKC,MAC5BnC,EAAKyH,oCAAqC,EAE1CzH,EAAKmI,iBAAmBnI,EAAKmI,iBAAiBvH,KAAtBX,OAAAY,EAAA,EAAAZ,CAAAD,IACxBA,EAAKoI,0BAA4BpI,EAAKoI,0BAA0BxH,KAA/BX,OAAAY,EAAA,EAAAZ,CAAAD,IACjCA,EAAKqI,0BAA4BrI,EAAKqI,0BAA0BzH,KAA/BX,OAAAY,EAAA,EAAAZ,CAAAD,IACjCA,EAAKsI,4BAA8BtI,EAAKsI,4BAA4B1H,KAAjCX,OAAAY,EAAA,EAAAZ,CAAAD,IACnCA,EAAKuI,sBAAwBvI,EAAKuI,sBAAsB3H,KAA3BX,OAAAY,EAAA,EAAAZ,CAAAD,IAC7BA,EAAKwI,iBAAmBxI,EAAKwI,iBAAiB5H,KAAtBX,OAAAY,EAAA,EAAAZ,CAAAD,IACxBA,EAAKyI,wBAA0BzI,EAAKyI,wBAAwB7H,KAA7BX,OAAAY,EAAA,EAAAZ,CAAAD,IAC/BA,EAAK0I,SAAW1I,EAAK0I,SAAS9H,KAAdX,OAAAY,EAAA,EAAAZ,CAAAD,IAChBA,EAAK2I,aAAe3I,EAAK2I,aAAa/H,KAAlBX,OAAAY,EAAA,EAAAZ,CAAAD,IACpBA,EAAK4I,cAAgB5I,EAAK4I,cAAchI,KAAnBX,OAAAY,EAAA,EAAAZ,CAAAD,IAnCCA,EAN1B,OAAAC,OAAA4I,EAAA,EAAA5I,CAAAqH,EAAAC,GAAAtH,OAAA6I,EAAA,EAAA7I,CAAAqH,EAAA,EAAAyB,IAAA,oBAAArK,MAAA,WA6CIwC,OAAO8H,iBAAiB,SAAU7I,KAAK8I,QAAQrI,KAAKT,OACpDA,KAAK8I,UACL9I,KAAKuI,SAASvI,KAAKM,MAAMgG,YACzBtG,KAAKwI,eACLxI,KAAK+I,qBAjDT,CAAAH,IAAA,uBAAArK,MAAA,eAAAqK,IAAA,WAAArK,MAAA,SAuDWyK,GAAmB,IAAArI,EAAAX,KACtBiJ,EAAM/K,EAAmBG,SAAS2K,GAAWzK,MACjD2K,YAAYD,EAAK,SAACE,EAAYC,GAC5B,GAAa,MAATD,EAAe,CACjB,IAAI3B,EAAetJ,EAAmBE,aACT,MAAzBgL,EAAS5B,eACXA,EAAe4B,EAAS5B,cAE1B,IAAIC,EAAY,IAAI1F,KAAKA,KAAKsH,MAAMD,EAASE,iBACzC3B,EAAiByB,EAASzB,eAC1BpF,EAAQ6G,EAAS7G,MACjBV,EAAauH,EAASvH,WAG1B,GAAIU,EAAMjB,OAAS,GAAKiB,EAAMjB,QAAU,GACtC,IAAK,IAAI2E,EAAI,EAAGA,EAAI1D,EAAMjB,OAAQ2E,IAChC1D,EAAM0D,GAAGvH,MAAQR,EAAmBS,OAAOsH,EAAI/H,EAAmBS,OAAO2C,QAI7EX,EAAKsB,gBAAkBF,KAAKC,MAC5BrB,EAAKyB,SAAS,CACZoF,aAAcA,EACdC,UAAWA,EACXlF,MAAOA,EACPV,WAAYA,EACZ8F,eAAgBA,SAjF1B,CAAAiB,IAAA,eAAArK,MAAA,WAuFiB,IAAAgL,EAAAvJ,KACbkJ,YAAYhL,EAAmBc,YAAa,SAACmK,EAAYC,GACvD,GAAa,MAATD,EAAe,CACjB,IAAI/H,EAAQgI,EACZhI,EAAMoI,OACND,EAAKnH,SAAS,CACZ0F,SAAU1G,SA7FpB,CAAAwH,IAAA,mBAAArK,MAAA,WAmGqB,IAAAkL,EAAAzJ,KACjBkJ,YAAYhL,EAAmBa,WAAY,SAACoK,EAAYC,GACtD,GAAa,MAATD,EAAe,CACjB,IAAI/H,EAAQgI,EACZK,EAAKrH,SAAS,CACZhB,MAAOA,SAxGjB,CAAAwH,IAAA,cAAArK,MAAA,WAgHI,OAAoC,GAA7ByB,KAAKM,MAAMoH,gBAAuB,MAhH7C,CAAAkB,IAAA,gBAAArK,MAAA,WAoHI,GAA4B,MAAxByB,KAAKM,MAAMmH,UAAmB,CAChC,IAAM3F,EAAYC,KAAKC,MAAQhC,KAAKiC,gBAC9BC,EAAWlC,KAAK0J,cAElBC,EAAmB7H,EAAYI,EAC/B2F,EAAqB+B,KAAKC,MAAOF,EAAkBzH,EAAY,KAI/D4H,EADc,EAAc9J,KAAKM,MAAMqH,eACViC,KAAKC,MAAMF,GAAmB3J,KAAKM,MAAMuB,WAAaK,IACnF6H,EAAyB/J,KAAKgK,eAAeF,GAEjD9J,KAAKoC,SAAS,CACZwF,aAAcmC,EACdlC,mBAAoBA,OAlI5B,CAAAe,IAAA,iBAAArK,MAAA,SAuIiBuL,GACX,IAAIG,EAAqBH,EAAiB9J,KAAKM,MAAMqH,eACjDuC,EAAc,IAAInI,KAAK/B,KAAKM,MAAMmH,UAAU0C,UAAiC,IAArBF,GACxDG,EAAUrD,OAAOmD,EAAYG,cAIjC,OAHID,EAAQ9I,OAAS,IACnB8I,EAAU,IAAMA,GAEXF,EAAYI,UAAY,KAAOJ,EAAYK,WAAa,GAAK,IAAML,EAAYM,cAAgB,IAAMN,EAAYO,WAAa,IAAML,IA9IjJ,CAAAxB,IAAA,mBAAArK,MAAA,SAiJmBmM,GACf,IAAM5I,EAAYC,KAAKC,MAAQhC,KAAKiC,gBAC9BC,EAAWlC,KAAK0J,cAClBC,EAAmB7H,EAAYI,EAE/ByI,EADwBD,EAAME,OAAOrM,MACS,IAAO2D,EACrD2I,EAAqB7K,KAAKiC,iBAAmB0H,EAAkBgB,GACnE3K,KAAKiC,gBAAkB4I,IAxJ3B,CAAAjC,IAAA,0BAAArK,MAAA,SA2J0BmM,GACtB,IAAII,EAAiBJ,EAAME,OAAOrM,MAClC,GAAsB,MAAlBuM,GAA0BA,EAAexJ,OAAS,EAAG,CACvD,IAAIkB,EAAcuI,WAAWD,GACzBtI,GAAe,EACjBA,EAAc,KACLA,EAAc,UACvBA,EAAc,SAEhBxC,KAAKoC,SAAS,CAACI,YAAaA,IAC5BxC,KAAKqH,eAAe7E,YAAcA,EAClC+E,EAAMd,oBAAoBzG,KAAKqH,qBAE/BrH,KAAKoC,SAAS,CAACI,YAAatE,EAAmBY,qBAC/CkB,KAAKqH,eAAe7E,YAAc,KAClC+E,EAAMd,oBAAoBzG,KAAKqH,kBA1KrC,CAAAuB,IAAA,8BAAArK,MAAA,SA8K8BmM,GAC1B,IAAIM,EAAqBN,EAAME,OAAOrM,MACtC,GAA0B,MAAtByM,GAA8BA,EAAmB1J,OAAS,EAAG,CAC/D,IAAIoG,EAAkBqD,WAAWC,GAC7BtD,GAAmB,EACrBA,EAAkB,KACTA,EAAkB,UAC3BA,EAAkB,SAEpB,IAAM5F,EAAYC,KAAKC,MAAQhC,KAAKiC,gBAC9BC,EAAWlC,KAAK0J,cAElBuB,EAAgC,GAAlBvD,EAAuB,IAGrCmD,EAAqB7K,KAAKiC,iBACxBH,EAAYmJ,EAAgBA,GAAgBnJ,EAAYI,EAAYA,IAC1ElC,KAAKiC,gBAAkB4I,EAEvB7K,KAAKoC,SAAS,CACZsF,gBAAiBA,IAEnB1H,KAAKqH,eAAenF,SAAWwF,EAC/BH,EAAMd,oBAAoBzG,KAAKqH,qBAE/BrH,KAAKoC,SAAS,CAACsF,gBAAiBxJ,EAAmBW,yBACnDmB,KAAKqH,eAAe7E,YAAc,KAClC+E,EAAMd,oBAAoBzG,KAAKqH,kBAzMrC,CAAAuB,IAAA,4BAAArK,MAAA,SA6M4B2M,EAA0CC,GAClC,MAA5BD,IACFA,EAA2B,IAE7B,IAAI7J,EAA6B6J,EAAyBhI,IAAI,SAACzB,GAAD,OAAYA,EAAElD,QACxE6M,EAA0BpL,KAAKM,MAAMe,iBAAiBC,OAASD,EAAiBC,OAChFtB,KAAKM,MAAMe,iBAAiBC,SAAWD,EAAiBC,SAC1DtB,KAAKsH,oCAAqC,GAE5CtH,KAAKoC,SAAS,CAACf,iBAAkBA,IACjCrB,KAAKqH,eAAehG,iBAAmBA,EACvCkG,EAAMd,oBAAoBzG,KAAKqH,gBAC3B+D,GACFpL,KAAKkI,8BA1NX,CAAAU,IAAA,4BAAArK,MAAA,WA8N8B,IAAA8M,EAAArL,KAC1B,IAAgD,IAA5CA,KAAKsH,mCAA6C,CAEpD,IAAIgE,EAAatL,KAAKM,MAAMiC,MAC5BvC,KAAKoC,SAAS,CAACG,MAAO,OACtBgJ,WAAW,WACTF,EAAK/D,oCAAqC,EAC1C+D,EAAKjJ,SAAS,CAACG,MAAO+I,KACrB,QAtOT,CAAA1C,IAAA,mBAAArK,MAAA,SA0OmBiN,EAAyBL,GACxC,GAAe,MAAXK,EAAiB,CACnB,IAAIlF,EAAapI,EAAmBG,SAASoN,UAAU,SAAAvK,GAAC,OAAIA,EAAE3C,QAAUiN,EAAQjN,QAC5EyB,KAAKM,MAAMgG,aAAeA,IAC5BvF,OAAOkG,QAAQC,UAAU,GAAI,GAAI,IACjClH,KAAKoC,SAAS,CAACG,MAAO,KAAM+D,WAAYA,IACxCtG,KAAKuI,SAASjC,GACdtG,KAAKqH,eAAef,WAAaA,EACjCiB,EAAMd,oBAAoBzG,KAAKqH,oBAlPvC,CAAAuB,IAAA,wBAAArK,MAAA,SAuPwB4F,GACpBnE,KAAKoC,SAAS,CAAC2F,UAAoB,OAAT5D,EAAgBA,EAAKG,OAAS,SAxP5D,CAAAsE,IAAA,UAAArK,MAAA,WA4PIyB,KAAK0L,kBAAkB,CACrBjM,MAAOsB,OAAO4K,WACdjM,OAAQqB,OAAO6K,gBA9PrB,CAAAhD,IAAA,oBAAArK,MAAA,SAkQoBmE,GAChB1C,KAAKoC,SAAS,CACZM,SAAU5C,OAAO+L,OAAO,GAAI7L,KAAKM,MAAMoC,SAAUA,OApQvD,CAAAkG,IAAA,SAAArK,MAAA,WAwQW,IAAAuN,EACuK9L,KAAKM,MAA5KkH,EADAsE,EACAtE,aAAcjF,EADduJ,EACcvJ,MAAOqF,EADrBkE,EACqBlE,aAAc/F,EADnCiK,EACmCjK,WAAY6F,EAD/CoE,EAC+CpE,gBAAiBlF,EADhEsJ,EACgEtJ,YAAaqF,EAD7EiE,EAC6EjE,mBAAoBxG,EADjGyK,EACiGzK,iBAAkByG,EADnHgE,EACmHhE,SAAUxB,EAD7HwF,EAC6HxF,WAAYlF,EADzI0K,EACyI1K,MAAO2G,EADhJ+D,EACgJ/D,UAAWrF,EAD3JoJ,EAC2JpJ,SAE5JqJ,EAAuBjE,EAAS5E,IAAI,SAAAzB,GAAO,MAAO,CAAElD,MAASkD,EAAGnD,MAASmD,KACzEuK,EAA0B3K,EAAiB6B,IAAI,SAAAzB,GAAO,MAAO,CAAElD,MAASkD,EAAGnD,MAASmD,KAEtFwK,EAASzH,EAAA,2BACA,MAATjC,IACF0J,EAASzH,EAAA,cAAC0H,EAAD,OAGX,IAAIC,EAAW,KACE,MAAbpE,IACFoE,EACE3H,EAAA,cAAC4H,EAAA,EAAD,CAAOhN,UAAW2I,EAAUsE,SAASjJ,YAAY,GAAIjE,SAAU4I,EAAUsE,SAASjJ,YAAY,GAAIkJ,aAAa,EAAOC,cAAc,EAAOC,OAAO,eAChJhI,EAAA,qCAAuC,MAAxBuD,EAAUxD,WAAqBwD,EAAUxD,WAAWpG,KAAO,MAIhF,IAAIsO,EAAgB,KAKpB,OAJIvO,EAAmBG,SAASiD,OAAS,IACvCmL,EAAgBjI,EAAA,yBAAKA,EAAA,uCAAoBA,EAAA,yBAAKA,EAAA,cAACkI,EAAA,EAAD,CAAQC,QAASzO,EAAmBG,SAAUuO,SAAU5M,KAAKgI,iBAAkBzJ,MAAOL,EAAmBG,SAASiI,QAIhK9B,EAAA,qBAAK1B,GAAG,aACLmJ,EACDzH,EAAA,qBAAK1B,GAAG,aACN0B,EAAA,cAAC4H,EAAA,EAADtM,OAAA+L,OAAA,GACMnJ,EADN,CAEEmK,SAAU3O,EAAmBO,YAC7BqO,YAAY,EACZC,iBAAkB/M,KAAK0L,kBAAkBjL,KAAKT,MAC9CgN,qBAAsB9O,EAAmBe,cACzCuF,EAAA,cAACyI,EAAD,CACExK,cAAezC,KAAKoI,sBACpB/G,iBAAkBA,EAClBQ,WAAYA,EACZM,qBAAsBnC,KAAK0J,cAC3B5I,2BAA4Bd,KAAKyI,cACjCrH,MAAOA,EACPa,gBAAiBjC,KAAKiC,gBACtBM,MAAOA,EACPC,YAAaA,EACbE,SAAUA,IAEXyJ,IAGL3H,EAAA,qBAAK1B,GAAG,sBACN0B,EAAA,qBAAK1B,GAAG,aAAY0B,EAAA,wBAAKgD,IACzBhD,EAAA,qBAAK1B,GAAG,WACL2J,EACDjI,EAAA,wBAAKoD,GACLpD,EAAA,yBACEA,EAAA,gDACAA,EAAA,uBAAOM,UAAU,aAAaoI,KAAK,QAAQC,IAAI,IAAIC,IAAI,MAAM7O,MAAOwI,OAAOc,GAAqB+E,SAAU5M,KAAKqI,oBAEjH7D,EAAA,yBACEA,EAAA,4CACAA,EAAA,qBAAKM,UAAU,SACbN,EAAA,uBAAOM,UAAU,GAAGoI,KAAK,SAASG,aAActG,OAAOW,GAAkB4F,QAAStN,KAAKmI,8BAA+B3D,EAAA,qCAG1HA,EAAA,yBACEA,EAAA,+CACAA,EAAA,qBAAKM,UAAU,SACbN,EAAA,uBAAO0I,KAAK,SAASG,aAActG,OAAOvE,GAAc8K,QAAStN,KAAKsI,0BAA2B9D,EAAA,kCAGrGA,EAAA,yBACEA,EAAA,2CACAA,EAAA,yBACEA,EAAA,cAACkI,EAAA,EAAD,CACEa,mBAAmB,EACnBC,SAAO,EACPb,QAASZ,EACTa,SAAU5M,KAAKiI,0BACfwF,YAAazN,KAAKkI,0BAClBwF,YAAY,oBACZnP,MAAOyN,aAxVzB7E,EAAA,CAAyBvC,cAmWzB+I,SAAgBnJ,EAAA,cAACoJ,EAAD,MAASC,SAASC,KAAKC,YAAYF,SAASG,cAAc,SCvWtDC,QACW,cAA7BlN,OAAOkE,SAASiJ,UAEe,UAA7BnN,OAAOkE,SAASiJ,UAEhBnN,OAAOkE,SAASiJ,SAASC,MACvB,2DCZNR,IAASS,OAAOC,EAAAC,EAAAN,cAACJ,EAAD,MAASC,SAASU,eAAe,SDmI3C,kBAAmBC,WACrBA,UAAUC,cAAcC,MAAMC,KAAK,SAAAC,GACjCA,EAAaC","file":"static/js/main.3a942ba6.chunk.js","sourcesContent":["import { AppConfig } from \"./data-interfaces\";\n\nexport const CURRENT_APP_CONFIG: AppConfig = {\n    name: \"Default\",\n    defaultTitle: \"Buses and Ferries\",\n    dataUrls: [\n        { \n        label: \"Buses\", \n        value: process.env.REACT_APP_DATA_URL_1!\n        }\n    ],\n    mapboxStyle: process.env.REACT_APP_MAPBOX_STYLE!,\n    color: [23, 184, 190], // blue\n    colors: [\n        [0, 255, 246], // blue\n        [255, 235, 86], // yellow\n        [255, 109, 245], // pink\n        [0, 255, 119] // green\n    ],\n    highlightColor: [253, 128, 93], // orange\n    defaultLoopTimeMinutes: 1,\n    defaultTrailLength: 100,\n    geoJsonUrl: process.env.REACT_APP_GEOJSON_URL!,\n    stopListUrl: process.env.REACT_APP_STOP_LIST_URL!,\n    mapboxToken: process.env.REACT_APP_MAPBOX_TOKEN!,\n    getInitialViewport: () => {\n        return {\n            latitude: -27.44,\n            longitude: 153.05,\n            zoom: 11,\n            maxZoom: 20,\n            pitch: 45,\n            bearing: 0,\n            width: 500,\n            height: 500\n        };\n    }\n};","import * as React from 'react';\nimport DeckGL, {GeoJsonLayer, TripsLayer} from 'deck.gl';\nimport {DeckglOverlayProps, Trip, DeckflOverlayState} from './data-interfaces';\nimport { CURRENT_APP_CONFIG } from './app-config';\n\nexport default class DeckGLOverlay extends React.Component<DeckglOverlayProps, DeckflOverlayState> {\n\n  _animationFrame: number | null;\n  intervalId: any;\n\n  constructor(props: any) {\n    super(props);\n\n    this.state = {\n      currentTime: 0\n    };\n\n    this._animationFrame = null;\n\n    this.getColor = this.getColor.bind(this);\n  }\n\n  componentDidMount() {\n    this._animate();\n    this.intervalId = setInterval(() => this.props.periodicTripUpdateCallback(), 500);\n  }\n\n  componentWillUnmount() {\n    if (this._animationFrame != null) {\n      window.cancelAnimationFrame(this._animationFrame);\n    }\n     clearInterval(this.intervalId);\n  }\n  \n  getColor(d: Trip) {\n    let color = CURRENT_APP_CONFIG.color;\n\n    let tagColor = d.color;\n    if (tagColor != null) {\n      color = tagColor;\n    }\n\n    if (CURRENT_APP_CONFIG.highlightColor != null && d.stops != null) {\n      if (this.props.highlightedStops.length > 0) {\n        let self = this;\n        d.stops.forEach((n: string) => {\n          if (self.props.highlightedStops.find((hn: string) => n.toLowerCase() === hn.toLowerCase()) != null) {\n            color = CURRENT_APP_CONFIG.highlightColor;\n          }\n        });\n      }\n    }\n\n    return color;\n  }\n\n  _animate() {\n    if (this.props.loopLength != null) {\n      const timestamp = Date.now() - this.props.timestampOffset;\n      const loopTime = this.props.loopTimeMilliseconds; // the loop time in milliseconds that deck gl displays\n\n      // 432000 == 5 days\n\n      this.setState({\n        currentTime: (timestamp % loopTime) * (this.props.loopLength / loopTime)\n      });\n    }\n    this._animationFrame = window.requestAnimationFrame(this._animate.bind(this));\n  }\n\n  render() {\n    const {trips, trailLength, stops, handleOnHover, viewport} = this.props;\n    const {currentTime} = this.state;\n\n    let layers = [];\n    \n    if (trips != null) {\n      layers.push(new TripsLayer({\n        id: 'trips',\n        data: trips,\n        getPath: (d: any) => d.segments.map((p: any) => p.coordinates),\n        getTimestamps: (d: any) => d.segments.map((p: any) => p.timestamp),\n        getColor: this.getColor,\n        opacity: 0.3,\n        widthMinPixels: 2,\n        trailLength,\n        currentTime\n      }));\n    }\n\n    if (stops != null) {\n      layers.push(new GeoJsonLayer({\n        id: 'geojson-layer',\n        data: stops,\n        filled: true,\n        getFillColor: (d: any) => [0, 255, 178, 150],\n        stroked: true,\n        extruded: false,\n        pointRadiusScale: 100,\n        getRadius: (d: any) => 0.4,\n        pickable: true,\n        autoHighlight: true,\n        highlightColor: [0, 255, 178, 250],\n        onHover: handleOnHover,\n        onClick: (info: any) => console.log(info.object.properties.name)\n      }));\n    }\n\n    if (layers.length === 0) {\n      return null;\n    }\n\n    return (\n      <DeckGL\n        initialViewState={CURRENT_APP_CONFIG.getInitialViewport()}\n        viewState={viewport}\n        layers={layers}\n      />\n    );\n  }\n}\n","import * as React from 'react';\nimport './loader.css';\n\nexport default class Loader extends React.Component<any, any> {\n\n  render() {\n    return <div className=\"spinner-container\"><div className=\"spinner\">\n        <div className=\"spinner-circle spinner-circle-outer\"></div>\n        <div className=\"spinner-circle spinner-circle-inner\"></div>\n        <div className=\"spinner-circle spinner-circle-single-1\"></div>\n        <div className=\"spinner-circle spinner-circle-single-2\"></div>\n        <div className=\"text\">Loading</div>\n    </div></div>;\n  }\n}\n","import { KnownUrlParameters } from './data-interfaces';\n\nfunction getUrlParam(name: string): string {\n  let url = new URL(window.location.href);\n  let param = url.searchParams.get(name);\n  return param!;\n};\n\nfunction getNumber(numStr: string): number | null {\n  if (numStr != null) {\n    let numNum = Number(numStr);\n    if (!Number.isNaN(numNum)) {\n      return numNum;\n    }\n  }\n  return null;\n}\n\nconst PARAM_DATA_IDX = 'dataIdx';\nconst PARAM_LOOPTIME = 'loopTime';\nconst PARAM_TRAILLENGTH = 'trailLength';\nconst PARAM_HIGHLIGHTSTOPS = 'highlightStops';\n\nfunction updateKeyInString(keysString: string, sParam: string, sValue: string): string {\n  let sURLVariables = keysString.length > 0 ? keysString.split('&') : [];\n  \n  let parameterUpdated = false;\n  for (let i = 0; i < sURLVariables.length; i++) {\n      let sParameterName = sURLVariables[i].split('=');\n\n      if (sParameterName[0] === sParam) {\n          sURLVariables[i] = sParam+'='+(sValue||'');\n          parameterUpdated = true;\n      }\n  }\n  if (parameterUpdated === false) {\n      sURLVariables.push(sParam+'='+(sValue||''));\n  }\n\n  return sURLVariables.join('&');\n}\n\nexport default {\n  getKnownUrlParameters(): KnownUrlParameters {\n    let result: KnownUrlParameters = {\n      dataUrlIdx: null,\n      loopTime: null,\n      trailLength: null,\n      highlightedStops: null\n    };\n\n    // Convert day to dataUrlIdx\n    let dataIdx = getNumber(getUrlParam(PARAM_DATA_IDX));\n    if (dataIdx != null && dataIdx >= 0) {\n      result.dataUrlIdx = dataIdx;\n    }\n\n    // Validate loopTime\n    let loopTime = getNumber(getUrlParam(PARAM_LOOPTIME));\n    if (loopTime != null && loopTime > 0 && loopTime < 999999) {\n      result.loopTime = loopTime;\n    }\n\n    // Validate trailLength\n    let trailLength = getNumber(getUrlParam(PARAM_TRAILLENGTH));\n    if (trailLength != null && trailLength > 0 && trailLength < 999999) {\n      result.trailLength = trailLength;\n    }\n\n    // Validate highlightStop\n    let highlightStops = getUrlParam(PARAM_HIGHLIGHTSTOPS);\n    if (highlightStops != null && highlightStops.length > 0) {\n      result.highlightedStops = highlightStops.split(',');\n    }\n\n    return result;\n  },\n\n  updateUrlParameters(params: KnownUrlParameters) {\n    let newStateStr = decodeURIComponent(window.location.search.substring(1));\n    if (params.dataUrlIdx != null) {\n      newStateStr = updateKeyInString(newStateStr, PARAM_DATA_IDX, String(params.dataUrlIdx));\n    }\n    if (params.loopTime != null) {\n      newStateStr = updateKeyInString(newStateStr, PARAM_LOOPTIME, String(params.loopTime));\n    }\n    if (params.trailLength != null) {\n      newStateStr = updateKeyInString(newStateStr, PARAM_TRAILLENGTH, String(params.trailLength));\n    }\n    if (params.highlightedStops != null) {\n      newStateStr = updateKeyInString(newStateStr, PARAM_HIGHLIGHTSTOPS, params.highlightedStops.join(','));\n    }\n    \n    let queryFilters = \"?\" + newStateStr;\n    window.history.pushState({}, \"\", queryFilters);\n  }\n}","import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport ReactMapGL, {Popup} from 'react-map-gl';\nimport {json as requestJson} from 'd3-request';\nimport DeckGLOverlay from './deckgl-overlay';\nimport Loader from './loader';\nimport {AppProps, AppState, KnownUrlParameters, TripContainer} from './data-interfaces';\nimport Utils from './utils';\nimport Select from 'react-select';\nimport * as geojson from 'geojson';\nimport './App.css';\nimport './select.css';\nimport 'mapbox-gl/dist/mapbox-gl.css';\nimport { ValueType, ActionMeta } from 'react-select/src/types';\nimport { CURRENT_APP_CONFIG } from './app-config';\n\nexport class App extends React.Component<AppProps, AppState> {\n\n  timestampOffset: number;\n  knownUrlParams: KnownUrlParameters;\n  highlighedStopsChangedBeforeReload: boolean;\n\n  constructor(props: any) {\n    super(props);\n\n    this.knownUrlParams = Utils.getKnownUrlParameters();\n\n    this.state = {\n      friendlyName: '',\n      startDate: new Date(2000, 1, 1, 0, 0, 0),\n      trips: null,\n      loopLength: 1000,\n      loopTimeMinutes: this.knownUrlParams.loopTime || CURRENT_APP_CONFIG.defaultLoopTimeMinutes,\n      timeMultiplier: 1,\n      friendlyTime: '',\n      trailLength: this.knownUrlParams.trailLength || CURRENT_APP_CONFIG.defaultTrailLength,\n      percentThroughLoop: 0,\n      highlightedStops: this.knownUrlParams.highlightedStops != null ? this.knownUrlParams.highlightedStops : [],\n      dataUrlIdx: this.knownUrlParams.dataUrlIdx || 0,\n      stopList: [],\n      stops: null,\n      popupInfo: null,\n      viewport: CURRENT_APP_CONFIG.getInitialViewport()\n    };\n\n    this.timestampOffset = Date.now();\n    this.highlighedStopsChangedBeforeReload = false;\n\n    this.handleDataChange = this.handleDataChange.bind(this);\n    this.handleHighlightStopChange = this.handleHighlightStopChange.bind(this);\n    this.handleHighlightStopReload = this.handleHighlightStopReload.bind(this);\n    this.handleLoopTimeMinutesChange = this.handleLoopTimeMinutesChange.bind(this);\n    this.handleOnHoverGeoPoint = this.handleOnHoverGeoPoint.bind(this);\n    this.handleTimeChange = this.handleTimeChange.bind(this);\n    this.handleTrailLengthChange = this.handleTrailLengthChange.bind(this);\n    this.loadData = this.loadData.bind(this);\n    this.loadStopList = this.loadStopList.bind(this);\n    this.updateBoxInfo = this.updateBoxInfo.bind(this);\n  }\n\n  componentDidMount() {\n    window.addEventListener('resize', this._resize.bind(this));\n    this._resize();\n    this.loadData(this.state.dataUrlIdx);\n    this.loadStopList();\n    this.loadGeoJsonStops();\n  }\n\n  componentWillUnmount() {\n  }\n\n  loadData(dayUrlIdx: number) {\n    let url = CURRENT_APP_CONFIG.dataUrls[dayUrlIdx].value;\n    requestJson(url, (error: any, response: TripContainer) => {\n      if (error == null) {\n        let friendlyName = CURRENT_APP_CONFIG.defaultTitle;\n        if (response.friendlyName != null) {\n          friendlyName = response.friendlyName;\n        }\n        let startDate = new Date(Date.parse(response.startTimestamp));\n        let timeMultiplier = response.timeMultiplier;\n        let trips = response.trips;\n        let loopLength = response.loopLength;\n\n        // allocate colours if there's a small number of trips\n        if (trips.length > 0 && trips.length <= 10) {\n          for (let i = 0; i < trips.length; i++) {\n            trips[i].color = CURRENT_APP_CONFIG.colors[i % CURRENT_APP_CONFIG.colors.length];\n          }\n        }\n\n        this.timestampOffset = Date.now();\n        this.setState({\n          friendlyName: friendlyName,\n          startDate: startDate,\n          trips: trips,\n          loopLength: loopLength,\n          timeMultiplier: timeMultiplier\n        });\n      }\n    });\n  }\n\n  loadStopList() {\n    requestJson(CURRENT_APP_CONFIG.stopListUrl, (error: any, response: any) => {\n      if (error == null) {\n        let stops = response as string[];\n        stops.sort();\n        this.setState({\n          stopList: stops\n        });\n      }\n    });\n  }\n\n  loadGeoJsonStops() {\n    requestJson(CURRENT_APP_CONFIG.geoJsonUrl, (error: any, response: any) => {\n      if (error == null) {\n        let stops = response as geojson.FeatureCollection<geojson.Point>;\n        this.setState({\n          stops: stops\n        });\n      }\n    });\n  }\n\n  // the loop time in milliseconds that deck gl displays\n  getLoopTime() {\n    return this.state.loopTimeMinutes * 60 * 1000; // in x * 1000, x is in seconds\n  }\n\n  updateBoxInfo() {\n    if (this.state.startDate != null) {\n      const timestamp = Date.now() - this.timestampOffset;\n      const loopTime = this.getLoopTime(); // the loop time in milliseconds that deck gl displays\n\n      let timeThroughLoop = (timestamp % loopTime);\n      let percentThroughLoop = Math.floor((timeThroughLoop / loopTime) * 100);\n\n      // show time\n      const startTime = 0 * 60 * 60 * this.state.timeMultiplier; // hourOfDay * seconds in hour\n      let timeSinceStart = startTime + Math.floor(timeThroughLoop * (this.state.loopLength / loopTime));\n      let calculatedFriendlyTime = this.toFriendlyTime(timeSinceStart);\n\n      this.setState({\n        friendlyTime: calculatedFriendlyTime,\n        percentThroughLoop: percentThroughLoop\n      });\n    }\n  }\n\n  toFriendlyTime(timeSinceStart: number) {\n      let realTimeSinceStart = timeSinceStart / this.state.timeMultiplier;\n      let currentDate = new Date(this.state.startDate.getTime() + realTimeSinceStart * 1000);\n      let minutes = String(currentDate.getMinutes());\n      if (minutes.length < 2) {\n        minutes = '0' + minutes;\n      }\n      return currentDate.getDate() + '/' + (currentDate.getMonth() + 1) + '/' + currentDate.getFullYear() + ' ' + currentDate.getHours() + ':' + minutes;\n  }\n\n  handleTimeChange(event: any) {\n    const timestamp = Date.now() - this.timestampOffset;\n    const loopTime = this.getLoopTime();\n    let timeThroughLoop = (timestamp % loopTime);\n    let newPercentThroughLoop = event.target.value;\n    let newTimeThroughLoop = (newPercentThroughLoop / 100) * loopTime;\n    let newTimestampOffset = this.timestampOffset + (timeThroughLoop - newTimeThroughLoop);\n    this.timestampOffset = newTimestampOffset;\n  }\n\n  handleTrailLengthChange(event: any) {\n    let trailLengthStr = event.target.value;\n    if (trailLengthStr != null && trailLengthStr.length > 0) {\n      let trailLength = parseFloat(trailLengthStr);\n      if (trailLength <= 0) {\n        trailLength = 0.0001;\n      } else if (trailLength > 9999999) {\n        trailLength = 9999999;\n      }\n      this.setState({trailLength: trailLength});\n      this.knownUrlParams.trailLength = trailLength;\n      Utils.updateUrlParameters(this.knownUrlParams);\n    } else {\n      this.setState({trailLength: CURRENT_APP_CONFIG.defaultTrailLength});\n      this.knownUrlParams.trailLength = null;\n      Utils.updateUrlParameters(this.knownUrlParams);\n    }\n  }\n\n  handleLoopTimeMinutesChange(event: any) {\n    let loopTimeMinutesStr = event.target.value;\n    if (loopTimeMinutesStr != null && loopTimeMinutesStr.length > 0) {\n      let loopTimeMinutes = parseFloat(loopTimeMinutesStr);\n      if (loopTimeMinutes <= 0) {\n        loopTimeMinutes = 0.0001;\n      } else if (loopTimeMinutes > 9999999) {\n        loopTimeMinutes = 9999999;\n      }\n      const timestamp = Date.now() - this.timestampOffset;\n      const loopTime = this.getLoopTime(); // the loop time in milliseconds that deck gl displays\n  \n      let newLoopTime = loopTimeMinutes * 60 * 1000; // in x * 1000, x is in seconds\n  \n      // Adjust the timestampOffset so that the new loop time kicks off at the same time as currently\n      let newTimestampOffset = this.timestampOffset \n        + ((timestamp % newLoopTime) - (newLoopTime * ((timestamp % loopTime) / loopTime)));\n      this.timestampOffset = newTimestampOffset;\n  \n      this.setState({\n        loopTimeMinutes: loopTimeMinutes\n      });\n      this.knownUrlParams.loopTime = loopTimeMinutes;\n      Utils.updateUrlParameters(this.knownUrlParams);\n    } else {\n      this.setState({loopTimeMinutes: CURRENT_APP_CONFIG.defaultLoopTimeMinutes});\n      this.knownUrlParams.trailLength = null;\n      Utils.updateUrlParameters(this.knownUrlParams);\n    }\n  }\n\n  handleHighlightStopChange(highlightedStopsCommaSep: ValueType<any>, action: ActionMeta) {\n    if (highlightedStopsCommaSep == null) {\n      highlightedStopsCommaSep = [];\n    }\n    let highlightedStops: string[] = highlightedStopsCommaSep.map((n: any) => n.value);\n    let highlightedStopsRemoved = this.state.highlightedStops.length > highlightedStops.length;\n    if (this.state.highlightedStops.length !== highlightedStops.length) {\n      this.highlighedStopsChangedBeforeReload = true;\n    }\n    this.setState({highlightedStops: highlightedStops});\n    this.knownUrlParams.highlightedStops = highlightedStops;\n    Utils.updateUrlParameters(this.knownUrlParams);\n    if (highlightedStopsRemoved) {\n      this.handleHighlightStopReload();\n    }\n  }\n\n  handleHighlightStopReload() {\n    if (this.highlighedStopsChangedBeforeReload === true) {\n      // a forceUpdate doesn't update the trip colours, so remove and re-add\n      let cacheTrips = this.state.trips;\n      this.setState({trips: null});\n      setTimeout(() => {\n        this.highlighedStopsChangedBeforeReload = false;\n        this.setState({trips: cacheTrips});\n      }, 200);\n    }\n  }\n\n  handleDataChange(dataUrl: ValueType<any>, action: ActionMeta) {    \n    if (dataUrl != null) {\n      let dataUrlIdx = CURRENT_APP_CONFIG.dataUrls.findIndex(d => d.value === dataUrl.value);\n      if (this.state.dataUrlIdx !== dataUrlIdx) {\n        window.history.pushState({}, '', '')\n        this.setState({trips: null, dataUrlIdx: dataUrlIdx});\n        this.loadData(dataUrlIdx);\n        this.knownUrlParams.dataUrlIdx = dataUrlIdx;\n        Utils.updateUrlParameters(this.knownUrlParams);\n      }\n    }\n  }\n\n  handleOnHoverGeoPoint(info: any) {\n    this.setState({popupInfo: info !== null ? info.object : null});\n  }\n\n  _resize() {\n    this._onViewportChange({\n      width: window.innerWidth,\n      height: window.innerHeight\n    });\n  }\n\n  _onViewportChange(viewport: any) {\n    this.setState({\n      viewport: Object.assign({}, this.state.viewport, viewport)\n    });\n  }\n\n  render() {\n    const {friendlyName, trips, friendlyTime, loopLength, loopTimeMinutes, trailLength, percentThroughLoop, highlightedStops, stopList, dataUrlIdx, stops, popupInfo, viewport} = this.state;\n\n    const stopListOptions: any = stopList.map(n => { return { \"value\": n, \"label\": n} });\n    const highlightedStopsVl: any = highlightedStops.map(n => { return { \"value\": n, \"label\": n} });\n\n    let loader = <span></span>;\n    if (trips == null) {\n      loader = <Loader />;\n    }\n\n    let popupEle = null;\n    if (popupInfo != null) {\n      popupEle =\n        <Popup longitude={popupInfo.geometry.coordinates[0]} latitude={popupInfo.geometry.coordinates[1]} closeButton={false} closeOnClick={false} anchor=\"bottom-left\">\n          <div>Bus Stop {popupInfo.properties != null ? popupInfo.properties.name : ''}</div>\n        </Popup>;\n    }\n\n    let selectDataEle = null;\n    if (CURRENT_APP_CONFIG.dataUrls.length > 1) {\n      selectDataEle = <div><h6>Select Data</h6><div><Select options={CURRENT_APP_CONFIG.dataUrls} onChange={this.handleDataChange} value={CURRENT_APP_CONFIG.dataUrls[dataUrlIdx]} /></div></div>;\n    }\n\n    return (\n      <div id=\"container\">\n        {loader}\n        <div id=\"divdeckgl\">\n          <ReactMapGL \n            {...viewport}\n            mapStyle={CURRENT_APP_CONFIG.mapboxStyle}\n            dragRotate={true}\n            onViewportChange={this._onViewportChange.bind(this)}\n            mapboxApiAccessToken={CURRENT_APP_CONFIG.mapboxToken}>\n            <DeckGLOverlay \n              handleOnHover={this.handleOnHoverGeoPoint}\n              highlightedStops={highlightedStops}\n              loopLength={loopLength}\n              loopTimeMilliseconds={this.getLoopTime()}\n              periodicTripUpdateCallback={this.updateBoxInfo}\n              stops={stops!}\n              timestampOffset={this.timestampOffset}\n              trips={trips}\n              trailLength={trailLength}\n              viewport={viewport}\n              />\n            {popupEle}\n          </ReactMapGL>\n        </div>\n        <div id=\"top-left-container\">\n          <div id=\"title-box\"><h1>{friendlyName}</h1></div>\n          <div id=\"divinfo\">\n            {selectDataEle}\n            <h3>{friendlyTime}</h3>\n            <div>\n              <h6>Adjust point in time</h6>\n              <input className=\"full-width\" type=\"range\" min=\"0\" max=\"100\" value={String(percentThroughLoop)} onChange={this.handleTimeChange} />\n            </div>\n            <div>\n              <h6>Adjust loop time</h6>\n              <div className=\"block\">\n                <input className=\"\" type=\"number\" defaultValue={String(loopTimeMinutes)} onInput={this.handleLoopTimeMinutesChange} /><label>mins</label>\n              </div>\n            </div>\n            <div>\n              <h6>Adjust trail length</h6>\n              <div className=\"block\">\n                <input type=\"number\" defaultValue={String(trailLength)} onInput={this.handleTrailLengthChange} /><label>x</label>\n              </div>\n            </div>\n            <div>\n              <h6>Highlight Stops</h6>\n              <div>\n                <Select\n                  closeMenuOnSelect={false}\n                  isMulti\n                  options={stopListOptions}\n                  onChange={this.handleHighlightStopChange}\n                  onMenuClose={this.handleHighlightStopReload}\n                  placeholder=\"Highlight stop(s)\"\n                  value={highlightedStopsVl}\n                />\n              </div>\n          </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nReactDOM.render(<App />, document.body.appendChild(document.createElement('div')));","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport {App} from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}