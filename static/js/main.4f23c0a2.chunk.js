(this["webpackJsonpdeckgl-trips"]=this["webpackJsonpdeckgl-trips"]||[]).push([[0],{127:function(e,t){},169:function(e,t,n){},187:function(e,t){},192:function(e,t,n){},193:function(e,t,n){},201:function(e,t,n){},202:function(e,t,n){},205:function(e,t,n){"use strict";n.r(t);var i=n(1),a=n.n(i),o=n(89),l=n.n(o),r=(n(169),n(11)),c=n(30),s=n(6),u=n(128),d=n(219),h=n(214),p=n(222),g=n(220),j=n(14),f=function(e){var t=Object(i.useState)(0),n=Object(s.a)(t,2),a=n[0],o=n[1],l=Object(i.useState)({id:0}),r=Object(s.a)(l,1)[0];Object(i.useEffect)((function(){return r.id=window.requestAnimationFrame((function t(){if(null!=e.loopLength){var n=Date.now()-e.timestampOffset,i=60*e.loopTimeMinutes*1e3;o(n%i*(e.loopLength/i))}r.id=window.requestAnimationFrame(t)})),function(){return window.cancelAnimationFrame(r.id)}}),[r,e.loopLength,e.timestampOffset,e.loopTimeMinutes]);var c=[];return null!=e.trips&&c.push(new h.a({id:"trips",data:e.trips,getPath:function(e){return e.segments.map((function(e){return e.coordinates}))},getTimestamps:function(e){return e.segments.map((function(e){return e.timestamp}))},getColor:function(t){var n=e.color,i=t.color;return null!=i&&(n=i),null!=t.nodes&&e.highlightedNodes.length>0&&t.nodes.forEach((function(t){null!=e.highlightedNodes.find((function(e){return t.toLowerCase()===e.toLowerCase()}))&&(n=e.highlightColor)})),n},opacity:.3,widthMinPixels:2,trailLength:e.trailLength,currentTime:a})),null!=e.nodes&&c.push(new p.a({id:"geojson-layer",data:e.nodes,filled:!0,getFillColor:function(t){var n,i=t,a=[0,255,178,150];return e.highlightedNodes.length>0&&(null===(n=i.properties)||void 0===n?void 0:n.name)&&null!=e.highlightedNodes.find((function(e){var t;return(null===(t=i.properties)||void 0===t?void 0:t.name.toLowerCase())===e.toLowerCase()}))&&(a=[255,109,245,150]),a},stroked:!0,extruded:!1,pointRadiusScale:100,getRadius:function(t){var n,i=t;return e.highlightedNodes.length>0&&(null===(n=i.properties)||void 0===n?void 0:n.name)&&null!=e.highlightedNodes.find((function(e){var t;return(null===(t=i.properties)||void 0===t?void 0:t.name.toLowerCase())===e.toLowerCase()}))?2:.4},pickable:!0,autoHighlight:!0,highlightColor:[0,255,178,250],onHover:e.handleOnHover,onClick:function(e){return console.log(e.object.properties.name)},transitions:{getFillColor:{type:"interpolation",duration:700,easing:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}},getRadius:{type:"spring",stiffness:.2,damping:.3}}})),0===c.length?null:Object(j.jsx)(g.a,{initialViewState:e.initialViewState,viewState:e.viewport,layers:c})},b=n(129),m=(n(192),n(193),function(e){var t=e.handleLoopTimeMinutes,n=e.handleTimestampOffset,a=e.handleTrailLength,o=e.handleDataChange,l=e.handleHighlightedNodes,r=e.reloadTrips,c=Object(i.useState)(""),u=Object(s.a)(c,2),d=u[0],h=u[1],p=Object(i.useState)(!1),g=Object(s.a)(p,2),f=g[0],m=g[1],O=Object(i.useState)(0),v=Object(s.a)(O,2),x=v[0],w=v[1],S=Object(i.useState)(!1),L=Object(s.a)(S,2),N=L[0],T=L[1];Object(i.useEffect)((function(){var e=setInterval((function(){return T((function(e){return!e}))}),1e3);return function(){clearInterval(e)}}),[]),Object(i.useEffect)((function(){if(null!=e.startDate){var t=Date.now()-e.timestampOffset,n=60*e.loopTimeMinutes*1e3,i=t%n,a=Math.floor(i/n*100),o=function(t){var n=t/e.timeMultiplier,i=new Date(e.startDate.getTime()+1e3*n),a=String(i.getMinutes());return a.length<2&&(a="0"+a),i.getDate()+"/"+(i.getMonth()+1)+"/"+i.getFullYear()+" "+i.getHours()+":"+a}(Math.floor(i*(e.loopLength/n)));h(o),w(a)}}),[N,e.timestampOffset,e.loopLength,e.loopTimeMinutes,e.startDate,e.timeMultiplier]);var C=function(){return 60*e.loopTimeMinutes*1e3},M=function(t){null==t&&(t=[]);var n=t.map((function(e){return e.value})),i=e.highlightedNodes.length>n.length;l(n),i&&r()},y=function(e){m(e)},I=e.appConfig.dataSamples.map((function(e,t){return{value:t,label:e.title}})),D=e.nodeList.map((function(e){return{value:e,label:e}})),k=e.highlightedNodes.map((function(e){return{value:e,label:e}})),E=null;return e.appConfig.dataSamples.length>1&&(E=Object(j.jsxs)("div",{children:[Object(j.jsx)("h6",{children:"Select Data"}),Object(j.jsx)("div",{children:Object(j.jsx)(b.a,{options:I,onChange:function(e){null!=e&&(M([]),o(e.value))},value:I[e.dataSampleIdx]})})]})),Object(j.jsxs)("div",{id:"top-left-container",children:[Object(j.jsx)("div",{id:"title-box",children:Object(j.jsx)("h1",{children:e.friendlyName})}),Object(j.jsxs)("div",{id:"divinfo",className:f?"hide":"",children:[Object(j.jsx)("button",{id:"btnHideInfoBox",className:"btn-transparent right-align",onClick:function(){return y(!0)},children:"X"}),E,Object(j.jsx)("h3",{children:d}),Object(j.jsxs)("div",{children:[Object(j.jsx)("h6",{children:"Adjust point in time"}),Object(j.jsx)("input",{className:"full-width",type:"range",min:"0",max:"100",value:String(x),onChange:function(t){var i=Date.now()-e.timestampOffset,a=C(),o=i%a,l=t.target.value/100*a,r=e.timestampOffset+(o-l);n(r)}})]}),Object(j.jsxs)("div",{children:[Object(j.jsx)("h6",{children:"Adjust loop time"}),Object(j.jsxs)("div",{className:"block",children:[Object(j.jsx)("input",{className:"",type:"number",value:String(e.loopTimeMinutes),onInput:function(i){var a=i.target.value;if(null!=a&&a.length>0){var o=parseFloat(a);o<=0?o=1e-4:o>9999999&&(o=9999999);var l=Date.now()-e.timestampOffset,r=C(),c=60*o*1e3,s=e.timestampOffset+(l%c-c*(l%r/r));n(s),t(o)}else t(e.appConfig.initialLoopTimeMinutes)}}),Object(j.jsx)("label",{children:"mins"})]})]}),Object(j.jsxs)("div",{children:[Object(j.jsx)("h6",{children:"Adjust trail length"}),Object(j.jsxs)("div",{className:"block",children:[Object(j.jsx)("input",{type:"number",value:String(e.trailLength),onInput:function(t){var n=t.target.value;if(null!=n&&n.length>0){var i=parseFloat(n);i<=0?i=1e-4:i>9999999&&(i=9999999),a(i)}else a(e.appConfig.initialTrailLength)}}),Object(j.jsx)("label",{children:"x"})]})]}),Object(j.jsxs)("div",{children:[Object(j.jsxs)("h6",{children:["Highlight Trips via ",e.appConfig.nodeLabelPlural]}),Object(j.jsx)("div",{children:Object(j.jsx)(b.a,{closeMenuOnSelect:!1,isMulti:!0,options:D,onChange:M,onMenuClose:e.reloadTrips,placeholder:"Select "+e.appConfig.nodeLabelPlural,value:k})})]})]}),Object(j.jsx)("button",{id:"btnShowInfoBox",className:"btn-transparent "+(f?"":"hide"),onClick:function(){return y(!1)},children:"SHOW INFO BOX"})]})}),O=n(3),v=n(2),x=n(8),w=n(154),S=(n(201),function(e){Object(x.a)(n,e);var t=Object(w.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(v.a)(n,[{key:"render",value:function(){return Object(j.jsx)("div",{className:"spinner-container",children:Object(j.jsxs)("div",{className:"spinner",children:[Object(j.jsx)("div",{className:"spinner-circle spinner-circle-outer"}),Object(j.jsx)("div",{className:"spinner-circle spinner-circle-inner"}),Object(j.jsx)("div",{className:"spinner-circle spinner-circle-single-1"}),Object(j.jsx)("div",{className:"spinner-circle spinner-circle-single-2"}),Object(j.jsx)("div",{className:"text",children:"Loading"})]})})}}]),n}(i.Component));function L(e){return new URL(window.location.href).searchParams.get(e)}function N(e){if(null!=e){var t=Number(e);if(!Number.isNaN(t))return t}return null}var T="dataIdx",C="loopTime",M="trailLength",y="highlightNodes";function I(e,t,n){for(var i=e.length>0?e.split("&"):[],a=!1,o=0;o<i.length;o++){i[o].split("=")[0]===t&&(i[o]=t+"="+(n||""),a=!0)}return!1===a&&i.push(t+"="+(n||"")),i.join("&")}n(202),n(203);var D={color:[255,235,86],colors:[[255,109,245],[0,255,119]],dataSamples:[],highlightColor:[255,109,245],initialLoopTimeMinutes:1,initialTrailLength:100,initialViewport:{latitude:19.045632,longitude:68.538902,zoom:3,maxZoom:20,pitch:45,bearing:0,width:500,height:500},mapboxStyle:"mapbox://styles/mapbox/dark-v10",nodeLabel:"Node",nodeLabelPlural:"Nodes",title:"Trips"},k=function(){return{width:window.innerWidth,height:window.innerHeight}},E=function(){var e=Object(i.useState)(function(){var e={dataSampleIdx:null,loopTime:null,trailLength:null,highlightedNodes:null},t=N(L(T));null!=t&&t>=0&&(e.dataSampleIdx=t);var n=N(L(C));null!=n&&n>0&&n<999999&&(e.loopTime=n);var i=N(L(M));null!=i&&i>0&&i<999999&&(e.trailLength=i);var a=L(y);return null!=a&&a.length>0&&(e.highlightedNodes=a.split(",")),e}()),t=Object(s.a)(e,2),n=t[0],a=t[1],o=Object(i.useState)(D),l=Object(s.a)(o,2),h=l[0],p=l[1],g=Object(i.useState)(n.dataSampleIdx||-1),b=Object(s.a)(g,2),O=b[0],v=b[1],x=Object(i.useState)(""),w=Object(s.a)(x,2),E=w[0],F=w[1],H=Object(i.useState)(null!=n.highlightedNodes?n.highlightedNodes:[]),V=Object(s.a)(H,2),A=V[0],P=V[1],J=Object(i.useState)(1e3),R=Object(s.a)(J,2),B=R[0],G=R[1],U=Object(i.useState)(n.loopTime||D.initialLoopTimeMinutes),Z=Object(s.a)(U,2),q=Z[0],z=Z[1],W=Object(i.useState)([]),X=Object(s.a)(W,2),Y=X[0],_=X[1],K=Object(i.useState)(null),Q=Object(s.a)(K,2),$=Q[0],ee=Q[1],te=Object(i.useState)(null),ne=Object(s.a)(te,2),ie=ne[0],ae=ne[1],oe=Object(i.useState)(new Date(2e3,1,1,0,0,0)),le=Object(s.a)(oe,2),re=le[0],ce=le[1],se=Object(i.useState)(Date.now()),ue=Object(s.a)(se,2),de=ue[0],he=ue[1],pe=Object(i.useState)(1),ge=Object(s.a)(pe,2),je=ge[0],fe=ge[1],be=Object(i.useState)(n.trailLength||D.initialTrailLength),me=Object(s.a)(be,2),Oe=me[0],ve=me[1],xe=Object(i.useState)(null),we=Object(s.a)(xe,2),Se=we[0],Le=we[1],Ne=Object(i.useState)(Object(c.a)(Object(c.a)({},D.initialViewport),{},{transitionDuration:2e3,transitionInterpolator:new d.a})),Te=Object(s.a)(Ne,2),Ce=Te[0],Me=Te[1];Object(i.useEffect)((function(){var e=function(){return Me((function(e){return Object(c.a)(Object(c.a)({},e),k())}))};return window.addEventListener("resize",e),fetch("app-settings.json",{method:"GET",headers:{Accept:"application/json; charset=utf-8"}}).then((function(e){200===e.status?e.json().then((function(e){p((function(t){return Object(c.a)(Object(c.a)({},t),e)}))})):console.log("Sorry, could not load config ("+e.status+")")})).catch((function(e){console.log(e)})),function(){return window.removeEventListener("resize",e)}}),[]),Object(i.useEffect)((function(){z(n.loopTime||h.initialLoopTimeMinutes),ve(n.trailLength||h.initialTrailLength)}),[n,h]),Object(i.useEffect)((function(){var e;h.dataSamples.length>0&&(O<=-1?v(0):(a((function(e){return Object(c.a)(Object(c.a)({},e),{},{dataSampleIdx:O})})),v(O),function(e){var t=h.dataSamples[e].tripsUrl;fetch(t).then((function(e){200===e.status?e.json().then((function(e){var t=h.title;null!=e.friendlyName&&(t=e.friendlyName);var n=Number(e.startTimestamp)?new Date(1e3*e.startTimestamp):new Date(Date.parse(e.startTimestamp)),i=e.timeMultiplier,a=e.trips,o=e.loopLength;if(a.length>0&&a.length<=10)for(var l=0;l<a.length;l++)a[l].color=h.colors[l%h.colors.length];ce(n),he(Date.now()),F(t),Le(a),G(o),fe(i)})):console.log("Something went wrong loading trips ("+e.status+")")})).catch((function(e){console.log(e)}))}(O),e=O,fetch(h.dataSamples[e].nodeListUrl).then((function(e){200===e.status?e.json().then((function(e){e.sort(),_(e)})):console.log("Something went wrong loading node list ("+e.status+")")})).catch((function(e){console.log(e)})),function(e){fetch(h.dataSamples[e].geoJsonUrl).then((function(e){200===e.status?e.json().then((function(e){ee(e)})):console.log("Something went wrong loading GeoJSON nodes ("+e.status+")")})).catch((function(e){console.log(e)}))}(O),Me((function(e){return Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)({},e),h.initialViewport),h.dataSamples[O].initialPartialViewport),k())}))))}),[O,h]),Object(i.useEffect)((function(){window.history.pushState({},"",""),function(e){var t=decodeURIComponent(window.location.search.substring(1));null!=e.dataSampleIdx&&(t=I(t,T,String(e.dataSampleIdx))),null!=e.loopTime&&(t=I(t,C,String(e.loopTime))),null!=e.trailLength&&(t=I(t,M,String(e.trailLength))),null!=e.highlightedNodes&&(t=I(t,y,e.highlightedNodes.join(",")));var n="?"+t;window.history.pushState({},"",n)}(n)}),[n]);var ye=Object(j.jsx)("span",{});null==Se&&(ye=Object(j.jsx)(S,{}));var Ie=null;return null!=ie&&(Ie=Object(j.jsx)(u.a,{longitude:ie.geometry.coordinates[0],latitude:ie.geometry.coordinates[1],closeButton:!1,closeOnClick:!1,anchor:"bottom-left",children:Object(j.jsxs)("div",{className:"popup-inner",children:[h.nodeLabel," ",null!=ie.properties?ie.properties.name:""]})})),Object(j.jsxs)("div",{id:"container",children:[ye,Object(j.jsx)("div",{id:"divdeckgl",children:Object(j.jsxs)(u.b,Object(c.a)(Object(c.a)({},Ce),{},{mapStyle:h.mapboxStyle,dragRotate:!0,onViewportChange:function(e){Me((function(t){return Object(c.a)(Object(c.a)(Object(c.a)({},t),e),k())}))},mapboxApiAccessToken:"pk.eyJ1Ijoic3RldmVqayIsImEiOiJja24ya3dvZGMxOGZhMnZtbG9lOGJkem44In0.5vrcHDx_DfpxCXSLWwi4Ng",children:[Object(j.jsx)(f,{color:h.color,handleOnHover:function(e){ae(null!==e?e.object:null)},highlightColor:h.highlightColor,highlightedNodes:A,initialViewState:h.initialViewport,loopLength:B,loopTimeMinutes:q,nodes:$,timestampOffset:de,trips:Se,trailLength:Oe,viewport:Ce}),Ie]}))}),Object(j.jsx)(m,{appConfig:h,dataSampleIdx:O,friendlyName:E,handleDataChange:function(e){v(e)},highlightedNodes:A,handleHighlightedNodes:function(e){P(e),a((function(t){return Object(c.a)(Object(c.a)({},t),{},{highlightedNodes:e})})),ee((function(e){return e?Object(c.a)({},e):e}))},loopLength:B,loopTimeMinutes:q,handleLoopTimeMinutes:function(e){z(e),a((function(t){return Object(c.a)(Object(c.a)({},t),{},{loopTime:e})}))},nodeList:Y,startDate:re,timestampOffset:de,handleTimestampOffset:function(e){he(e)},timeMultiplier:je,trailLength:Oe,handleTrailLength:function(e){ve(e),a((function(t){return Object(c.a)(Object(c.a)({},t),{},{trailLength:e})}))},reloadTrips:function(){Le((function(e){return e?Object(r.a)(e):e}))}})]})},F=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,225)).then((function(t){var n=t.getCLS,i=t.getFID,a=t.getFCP,o=t.getLCP,l=t.getTTFB;n(e),i(e),a(e),o(e),l(e)}))},H=n(100);n.n(H).a.workerClass=n(204).default,l.a.render(Object(j.jsx)(a.a.StrictMode,{children:Object(j.jsx)(E,{})}),document.getElementById("root")),F()}},[[205,1,2]]]);
//# sourceMappingURL=main.4f23c0a2.chunk.js.map