(this["webpackJsonpdeckgl-trips"]=this["webpackJsonpdeckgl-trips"]||[]).push([[0],{126:function(t,e){},167:function(t,e,i){},185:function(t,e){},190:function(t,e,i){},191:function(t,e,i){},192:function(t,e,i){},201:function(t,e,i){"use strict";i.r(e);var n=i(1),a=i.n(n),o=i(89),s=i.n(o),l=(i(167),i(123)),r=i(3),h=i(2),d=i(15),c=i(8),p=i(80),u=i(127),g=i(211),m=i(218),f=i(216),j=i(16),b=function(t){Object(c.a)(i,t);var e=Object(p.a)(i);function i(t){var n;return Object(r.a)(this,i),(n=e.call(this,t)).animationFrame=void 0,n.state={currentTime:0},n.animationFrame=null,n.animate=n.animate.bind(Object(d.a)(n)),n.getColor=n.getColor.bind(Object(d.a)(n)),n}return Object(h.a)(i,[{key:"componentDidMount",value:function(){this.animate()}},{key:"componentWillUnmount",value:function(){null!=this.animationFrame&&window.cancelAnimationFrame(this.animationFrame)}},{key:"animate",value:function(){if(null!=this.props.loopLength){var t=Date.now()-this.props.timestampOffset,e=this.props.loopTimeMilliseconds;this.setState({currentTime:t%e*(this.props.loopLength/e)})}this.animationFrame=window.requestAnimationFrame(this.animate.bind(this))}},{key:"getColor",value:function(t){var e=this,i=this.props.color,n=t.color;if(null!=n&&(i=n),null!=t.nodes&&this.props.highlightedNodes.length>0){var a=this;t.nodes.forEach((function(t){null!=a.props.highlightedNodes.find((function(e){return t.toLowerCase()===e.toLowerCase()}))&&(i=e.props.highlightColor)}))}return i}},{key:"render",value:function(){var t=this.props,e=t.handleOnHover,i=t.initialViewState,n=t.nodes,a=t.trips,o=t.trailLength,s=t.viewport,l=this.state.currentTime,r=[];return null!=a&&r.push(new g.a({id:"trips",data:a,getPath:function(t){return t.segments.map((function(t){return t.coordinates}))},getTimestamps:function(t){return t.segments.map((function(t){return t.timestamp}))},getColor:this.getColor,opacity:.3,widthMinPixels:2,trailLength:o,currentTime:l})),null!=n&&r.push(new m.a({id:"geojson-layer",data:n,filled:!0,getFillColor:function(){return[0,255,178,150]},stroked:!0,extruded:!1,pointRadiusScale:100,getRadius:function(){return.4},pickable:!0,autoHighlight:!0,highlightColor:[0,255,178,250],onHover:e,onClick:function(t){return console.log(t.object.properties.name)}})),0===r.length?null:Object(j.jsx)(f.a,{initialViewState:i,viewState:s,layers:r})}}]),i}(n.Component),v=(i(190),function(t){Object(c.a)(i,t);var e=Object(p.a)(i);function i(){return Object(r.a)(this,i),e.apply(this,arguments)}return Object(h.a)(i,[{key:"render",value:function(){return Object(j.jsx)("div",{className:"spinner-container",children:Object(j.jsxs)("div",{className:"spinner",children:[Object(j.jsx)("div",{className:"spinner-circle spinner-circle-outer"}),Object(j.jsx)("div",{className:"spinner-circle spinner-circle-inner"}),Object(j.jsx)("div",{className:"spinner-circle spinner-circle-single-1"}),Object(j.jsx)("div",{className:"spinner-circle spinner-circle-single-2"}),Object(j.jsx)("div",{className:"text",children:"Loading"})]})})}}]),i}(n.Component));function O(t){return new URL(window.location.href).searchParams.get(t)}function w(t){if(null!=t){var e=Number(t);if(!Number.isNaN(e))return e}return null}var x="dataIdx",C="loopTime",T="trailLength",L="highlightNodes";function S(t,e,i){for(var n=t.length>0?t.split("&"):[],a=!1,o=0;o<n.length;o++){n[o].split("=")[0]===e&&(n[o]=e+"="+(i||""),a=!0)}return!1===a&&n.push(e+"="+(i||"")),n.join("&")}function k(t){var e=decodeURIComponent(window.location.search.substring(1));null!=t.dataSampleIdx&&(e=S(e,x,String(t.dataSampleIdx))),null!=t.loopTime&&(e=S(e,C,String(t.loopTime))),null!=t.trailLength&&(e=S(e,T,String(t.trailLength))),null!=t.highlightedNodes&&(e=S(e,L,t.highlightedNodes.join(",")));var i="?"+e;window.history.pushState({},"",i)}var y=i(128),N=(i(191),i(192),i(193),{color:[23,184,190],colors:[[0,255,246],[255,235,86],[255,109,245],[0,255,119]],dataSamples:[{title:"SE QLD Transport",tripsUrl:"data/south-east-qld/trips.json",geoJsonUrl:"data/south-east-qld/geojson-stops.json",nodeListUrl:"data/south-east-qld/stops-list.json",initialPartialViewport:{latitude:-27.44,longitude:153.05,zoom:11}},{title:"SC Transport",tripsUrl:"data/sunshine-coast/trips.json",geoJsonUrl:"data/sunshine-coast/geojson-stops.json",nodeListUrl:"data/sunshine-coast/stops-list.json",initialPartialViewport:{latitude:-26.65,longitude:153.02,zoom:10}}],highlightColor:[253,128,93],initialLoopTimeMinutes:3,initialTrailLength:100,initialViewport:{latitude:-27.44,longitude:153.05,zoom:11,maxZoom:20,pitch:45,bearing:0,width:500,height:500},mapboxStyle:"mapbox://styles/stevejk/ckewepbut0ofs19obaw54z2lg",mapboxToken:"pk.eyJ1Ijoic3RldmVqayIsImEiOiJja24ya3dvZGMxOGZhMnZtbG9lOGJkem44In0.5vrcHDx_DfpxCXSLWwi4Ng",nodeLabel:"Stop",nodeLabelPlural:"Stops",title:"Trips"}),I=function(t){Object(c.a)(i,t);var e=Object(p.a)(i);function i(t){var n;Object(r.a)(this,i),(n=e.call(this,t)).intervalId=void 0,n.knownUrlParams=void 0,n.timestampOffset=void 0,n.knownUrlParams=function(){var t={dataSampleIdx:null,loopTime:null,trailLength:null,highlightedNodes:null},e=w(O(x));null!=e&&e>=0&&(t.dataSampleIdx=e);var i=w(O(C));null!=i&&i>0&&i<999999&&(t.loopTime=i);var n=w(O(T));null!=n&&n>0&&n<999999&&(t.trailLength=n);var a=O(L);return null!=a&&a.length>0&&(t.highlightedNodes=a.split(",")),t}();var a=n.knownUrlParams.dataSampleIdx||0;return n.state={appConfig:N,dataSampleIdx:a,friendlyName:"",friendlyTime:"",hideInfoBox:!1,highlightedNodes:null!=n.knownUrlParams.highlightedNodes?n.knownUrlParams.highlightedNodes:[],loopLength:1e3,loopTimeMinutes:n.knownUrlParams.loopTime||N.initialLoopTimeMinutes,nodeList:[],nodes:null,percentThroughLoop:0,popupInfo:null,startDate:new Date(2e3,1,1,0,0,0),timeMultiplier:1,trailLength:n.knownUrlParams.trailLength||N.initialTrailLength,trips:null,viewport:Object.assign({},N.initialViewport,N.dataSamples[a].initialPartialViewport)},n.timestampOffset=Date.now(),n.handleDataChange=n.handleDataChange.bind(Object(d.a)(n)),n.handleHighlightNodeChange=n.handleHighlightNodeChange.bind(Object(d.a)(n)),n.handleHighlightNodeReload=n.handleHighlightNodeReload.bind(Object(d.a)(n)),n.handleLoopTimeMinutesChange=n.handleLoopTimeMinutesChange.bind(Object(d.a)(n)),n.handleOnHoverGeoPoint=n.handleOnHoverGeoPoint.bind(Object(d.a)(n)),n.handleTimeChange=n.handleTimeChange.bind(Object(d.a)(n)),n.handleTrailLengthChange=n.handleTrailLengthChange.bind(Object(d.a)(n)),n.loadNodeList=n.loadNodeList.bind(Object(d.a)(n)),n.loadTrips=n.loadTrips.bind(Object(d.a)(n)),n.updateBoxInfo=n.updateBoxInfo.bind(Object(d.a)(n)),n}return Object(h.a)(i,[{key:"componentDidMount",value:function(){var t=this;window.addEventListener("resize",this.resize.bind(this)),this.resize(),this.loadTrips(this.state.dataSampleIdx),this.loadNodeList(this.state.dataSampleIdx),this.loadGeoJsonNodes(this.state.dataSampleIdx),this.intervalId=setInterval((function(){return t.updateBoxInfo()}),1e3)}},{key:"componentWillUnmount",value:function(){clearInterval(this.intervalId)}},{key:"loadTrips",value:function(t){var e=this.state.appConfig.dataSamples[t].tripsUrl,i=this;fetch(e,{method:"GET",headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json; charset=utf-8"}}).then((function(t){200===t.status?t.json().then((function(t){var e=i.state.appConfig.title;null!=t.friendlyName&&(e=t.friendlyName);var n=Number(t.startTimestamp)?new Date(1e3*t.startTimestamp):new Date(Date.parse(t.startTimestamp)),a=t.timeMultiplier,o=t.trips,s=t.loopLength;if(o.length>0&&o.length<=10)for(var l=0;l<o.length;l++)o[l].color=i.state.appConfig.colors[l%i.state.appConfig.colors.length];i.timestampOffset=Date.now(),i.setState({friendlyName:e,startDate:n,trips:o,loopLength:s,timeMultiplier:a})})):console.log("Sorry, something went wrong ("+t.status+")")})).catch((function(t){console.log(t)}))}},{key:"loadNodeList",value:function(t){var e=this;fetch(this.state.appConfig.dataSamples[t].nodeListUrl,{method:"GET",headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json; charset=utf-8"}}).then((function(t){200===t.status?t.json().then((function(t){t.sort(),e.setState({nodeList:t})})):console.log("Sorry, something went wrong ("+t.status+")")})).catch((function(t){console.log(t)}))}},{key:"loadGeoJsonNodes",value:function(t){var e=this;fetch(this.state.appConfig.dataSamples[t].geoJsonUrl,{method:"GET",headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json; charset=utf-8"}}).then((function(t){200===t.status?t.json().then((function(t){e.setState({nodes:t})})):console.log("Sorry, something went wrong ("+t.status+")")})).catch((function(t){console.log(t)}))}},{key:"getLoopTime",value:function(){return 60*this.state.loopTimeMinutes*1e3}},{key:"updateBoxInfo",value:function(){if(null!=this.state.startDate){var t=Date.now()-this.timestampOffset,e=this.getLoopTime(),i=t%e,n=Math.floor(i/e*100),a=0*this.state.timeMultiplier+Math.floor(i*(this.state.loopLength/e)),o=this.toFriendlyTime(a);this.setState({friendlyTime:o,percentThroughLoop:n})}}},{key:"toFriendlyTime",value:function(t){var e=t/this.state.timeMultiplier,i=new Date(this.state.startDate.getTime()+1e3*e),n=String(i.getMinutes());return n.length<2&&(n="0"+n),i.getDate()+"/"+(i.getMonth()+1)+"/"+i.getFullYear()+" "+i.getHours()+":"+n}},{key:"handleTimeChange",value:function(t){var e=Date.now()-this.timestampOffset,i=this.getLoopTime(),n=e%i,a=t.target.value/100*i,o=this.timestampOffset+(n-a);this.timestampOffset=o}},{key:"handleTrailLengthChange",value:function(t){var e=t.target.value;if(null!=e&&e.length>0){var i=parseFloat(e);i<=0?i=1e-4:i>9999999&&(i=9999999),this.setState({trailLength:i}),this.knownUrlParams.trailLength=i,k(this.knownUrlParams)}else this.setState({trailLength:this.state.appConfig.initialTrailLength}),this.knownUrlParams.trailLength=null,k(this.knownUrlParams)}},{key:"handleLoopTimeMinutesChange",value:function(t){var e=t.target.value;if(null!=e&&e.length>0){var i=parseFloat(e);i<=0?i=1e-4:i>9999999&&(i=9999999);var n=Date.now()-this.timestampOffset,a=this.getLoopTime(),o=60*i*1e3,s=this.timestampOffset+(n%o-o*(n%a/a));this.timestampOffset=s,this.setState({loopTimeMinutes:i}),this.knownUrlParams.loopTime=i,k(this.knownUrlParams)}else this.setState({loopTimeMinutes:this.state.appConfig.initialLoopTimeMinutes}),this.knownUrlParams.trailLength=null,k(this.knownUrlParams)}},{key:"handleHighlightNodeChange",value:function(t){null==t&&(t=[]);var e=t.map((function(t){return t.value})),i=this.state.highlightedNodes.length>e.length;this.setState({highlightedNodes:e}),this.knownUrlParams.highlightedNodes=e,k(this.knownUrlParams),i&&this.handleHighlightNodeReload()}},{key:"handleHighlightNodeReload",value:function(){this.setState({trips:Object.assign([],this.state.trips)})}},{key:"handleDataChange",value:function(t){if(null!=t&&this.state.dataSampleIdx!==t.value){this.handleHighlightNodeChange([]);var e=t.value;window.history.pushState({},"",""),this.setState({trips:null,dataSampleIdx:e}),this.loadTrips(e),this.loadNodeList(e),this.loadGeoJsonNodes(e),this.handleViewportChange(this.state.appConfig.dataSamples[e].initialPartialViewport),this.knownUrlParams.dataSampleIdx=e,k(this.knownUrlParams)}}},{key:"handleOnHoverGeoPoint",value:function(t){this.setState({popupInfo:null!==t?t.object:null})}},{key:"resize",value:function(){this.handleViewportChange({width:window.innerWidth,height:window.innerHeight})}},{key:"handleViewportChange",value:function(t){this.setState({viewport:Object.assign({},this.state.viewport,t)})}},{key:"handleInfoBoxVisibility",value:function(t){this.setState({hideInfoBox:t})}},{key:"render",value:function(){var t=this,e=this.state,i=e.appConfig,n=e.dataSampleIdx,a=e.friendlyName,o=e.friendlyTime,s=e.hideInfoBox,r=e.highlightedNodes,h=e.loopLength,d=e.loopTimeMinutes,c=e.nodeList,p=e.nodes,g=e.percentThroughLoop,m=e.popupInfo,f=e.trailLength,O=e.trips,w=e.viewport,x=this.state.appConfig.dataSamples.map((function(t,e){return{value:e,label:t.title}})),C=c.map((function(t){return{value:t,label:t}})),T=r.map((function(t){return{value:t,label:t}})),L=Object(j.jsx)("span",{});null==O&&(L=Object(j.jsx)(v,{}));var S=null;null!=m&&(S=Object(j.jsx)(u.a,{longitude:m.geometry.coordinates[0],latitude:m.geometry.coordinates[1],closeButton:!1,closeOnClick:!1,anchor:"bottom-left",children:Object(j.jsxs)("div",{className:"popup-inner",children:[this.state.appConfig.nodeLabel," ",null!=m.properties?m.properties.name:""]})}));var k=null;return this.state.appConfig.dataSamples.length>1&&(k=Object(j.jsxs)("div",{children:[Object(j.jsx)("h6",{children:"Select Data"}),Object(j.jsx)("div",{children:Object(j.jsx)(y.a,{options:x,onChange:this.handleDataChange,value:x[n]})})]})),Object(j.jsxs)("div",{id:"container",children:[L,Object(j.jsx)("div",{id:"divdeckgl",children:Object(j.jsxs)(u.b,Object(l.a)(Object(l.a)({},w),{},{mapStyle:this.state.appConfig.mapboxStyle,dragRotate:!0,onViewportChange:this.handleViewportChange.bind(this),mapboxApiAccessToken:this.state.appConfig.mapboxToken,children:[Object(j.jsx)(b,{color:i.color,handleOnHover:this.handleOnHoverGeoPoint,highlightColor:i.highlightColor,highlightedNodes:r,initialViewState:i.initialViewport,loopLength:h,loopTimeMilliseconds:this.getLoopTime(),nodes:p,timestampOffset:this.timestampOffset,trips:O,trailLength:f,viewport:w}),S]}))}),Object(j.jsxs)("div",{id:"top-left-container",children:[Object(j.jsx)("div",{id:"title-box",children:Object(j.jsx)("h1",{children:a})}),Object(j.jsxs)("div",{id:"divinfo",className:s?"hide":"",children:[Object(j.jsx)("button",{id:"btnHideInfoBox",className:"btn-transparent right-align",onClick:function(){return t.handleInfoBoxVisibility(!0)},children:"X"}),k,Object(j.jsx)("h3",{children:o}),Object(j.jsxs)("div",{children:[Object(j.jsx)("h6",{children:"Adjust point in time"}),Object(j.jsx)("input",{className:"full-width",type:"range",min:"0",max:"100",value:String(g),onChange:this.handleTimeChange})]}),Object(j.jsxs)("div",{children:[Object(j.jsx)("h6",{children:"Adjust loop time"}),Object(j.jsxs)("div",{className:"block",children:[Object(j.jsx)("input",{className:"",type:"number",defaultValue:String(d),onInput:this.handleLoopTimeMinutesChange}),Object(j.jsx)("label",{children:"mins"})]})]}),Object(j.jsxs)("div",{children:[Object(j.jsx)("h6",{children:"Adjust trail length"}),Object(j.jsxs)("div",{className:"block",children:[Object(j.jsx)("input",{type:"number",defaultValue:String(f),onInput:this.handleTrailLengthChange}),Object(j.jsx)("label",{children:"x"})]})]}),Object(j.jsxs)("div",{children:[Object(j.jsxs)("h6",{children:["Highlight ",this.state.appConfig.nodeLabelPlural]}),Object(j.jsx)("div",{children:Object(j.jsx)(y.a,{closeMenuOnSelect:!1,isMulti:!0,options:C,onChange:this.handleHighlightNodeChange,onMenuClose:this.handleHighlightNodeReload,placeholder:"Highlight "+this.state.appConfig.nodeLabelPlural,value:T})})]})]}),Object(j.jsx)("button",{id:"btnShowInfoBox",className:"btn-transparent "+(s?"":"hide"),onClick:function(){return t.handleInfoBoxVisibility(!1)},children:"SHOW INFO BOX"})]})]})}}]),i}(n.Component),P=function(t){t&&t instanceof Function&&i.e(3).then(i.bind(null,221)).then((function(e){var i=e.getCLS,n=e.getFID,a=e.getFCP,o=e.getLCP,s=e.getTTFB;i(t),n(t),a(t),o(t),s(t)}))};s.a.render(Object(j.jsx)(a.a.StrictMode,{children:Object(j.jsx)(I,{})}),document.getElementById("root")),P()}},[[201,1,2]]]);
//# sourceMappingURL=main.824e58a4.chunk.js.map